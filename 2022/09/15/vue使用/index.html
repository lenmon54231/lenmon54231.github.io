

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Meng_Lee">
  <meta name="keywords" content="">
  
    <meta name="description" content="Vue使用">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue使用">
<meta property="og:url" content="http://lenmon54231.github.io/2022/09/15/Vue%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Vue使用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNTU4NjUwMi00ZjJkM2Y3MWE5NGE0YTAwLnBuZw?x-oss-process=image/format,png">
<meta property="og:image" content="https://limengtupian.oss-cn-beijing.aliyuncs.com/canceltoken%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/cancletoken.png">
<meta property="og:image" content="https://img-blog.csdn.net/20180118114145818?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20180118115923234?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20180118120316317?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20180118120349241?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20180118120556118?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20180118121323658?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20180118121457269?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20180118121751176?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="article:published_time" content="2022-09-15T03:35:24.000Z">
<meta property="article:modified_time" content="2025-09-16T10:12:13.134Z">
<meta property="article:author" content="Meng_Lee">
<meta property="article:tag" content="vue">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNTU4NjUwMi00ZjJkM2Y3MWE5NGE0YTAwLnBuZw?x-oss-process=image/format,png">
  
  
  
  <title>Vue使用 - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"lenmon54231.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Vue使用"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-09-15 11:35" pubdate>
          2022年9月15日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          55k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          461 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Vue使用</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="Vue使用"><a href="#Vue使用" class="headerlink" title="Vue使用"></a>Vue使用</h2><span id="more"></span>

<h3 id="Vue常用库"><a href="#Vue常用库" class="headerlink" title="Vue常用库"></a>Vue常用库</h3><h4 id="toast库"><a href="#toast库" class="headerlink" title="toast库"></a>toast库</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">npm install vue-sonner<br></code></pre></td></tr></table></figure>

<h3 id="refs-的使用"><a href="#refs-的使用" class="headerlink" title="$refs 的使用"></a>$refs 的使用</h3><p>有时候会访问子组件实例或子元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 父组件</span><br>&lt;base-input ref=<span class="hljs-string">&quot;usernameInput&quot;</span>&gt;&lt;/base-input&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 子组件</span><br>&lt;input ref=<span class="hljs-string">&quot;input&quot;</span>&gt;<br></code></pre></td></tr></table></figure>

<p>那么，我们可以通过 refs 的形式来访问子组件内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>: &#123;<br>  <span class="hljs-comment">// 用来从父级组件聚焦输入框</span><br>  <span class="hljs-attr">focus</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">input</span>.<span class="hljs-title function_">focus</span>()<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="问题点"><a href="#问题点" class="headerlink" title="问题点"></a>问题点</h4><p>$refs 只会在组件渲染完成之后生效，并且它们不是响应式的。这仅作为一个用于直接操作子组件的“逃生舱”——<strong>你应该避免在模板或计算属性中访问 $refs</strong></p>
<p>即：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">computed</span>: &#123;<br>  <span class="hljs-title function_">players</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">playerRef</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">return</span> e.<span class="hljs-property">$el</span>;<br>    &#125;);<br>  &#125;,<br>&#125;,<br></code></pre></td></tr></table></figure>

<p>上述写法是不合理的，这种写法会导致不停的查询 ref 和渲染，导致画面抖动</p>
<h3 id="自定义指令-loading"><a href="#自定义指令-loading" class="headerlink" title="自定义指令 loading"></a>自定义指令 loading</h3><h4 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> loading <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./loading/index.js&quot;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">install</span>(<span class="hljs-params">Vue</span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&quot;loading&quot;</span>, loading);<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h4 id="绑定指令文件"><a href="#绑定指令文件" class="headerlink" title="绑定指令文件"></a>绑定指令文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> initPageLoading <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./initPageLoading.vue&quot;</span>;<br><span class="hljs-keyword">import</span> loading <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./normalLoading.vue&quot;</span>;<br><br><span class="hljs-keyword">const</span> initPageLoadingMask = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(initPageLoading); <span class="hljs-comment">// 页面初始化的loading动画（KIVICUBE文字动画）</span><br><span class="hljs-keyword">const</span> loadingMask = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(loading); <span class="hljs-comment">// 数据加载中的页面动画（转圈动画）</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleLoading</span> = (<span class="hljs-params">el, binding</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">value</span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      el.<span class="hljs-property">instance</span>.<span class="hljs-property">visible</span> = <span class="hljs-literal">true</span>;<br>      <span class="hljs-title function_">insertDom</span>(el, binding);<br>    &#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    el.<span class="hljs-property">instance</span>.<span class="hljs-property">visible</span> = <span class="hljs-literal">false</span>;<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">insertDom</span> = (<span class="hljs-params">el, binding</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; fullscreen &#125; = binding?.<span class="hljs-property">modifiers</span>;<br>  <span class="hljs-keyword">if</span> (fullscreen) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#app&quot;</span>).<span class="hljs-title function_">appendChild</span>(el.<span class="hljs-property">mask</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    el.<span class="hljs-title function_">appendChild</span>(el.<span class="hljs-property">mask</span>);<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createMask</span> = (<span class="hljs-params">fullscreen</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (fullscreen) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">initPageLoadingMask</span>(&#123;<br>      <span class="hljs-attr">el</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>),<br>      <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;&#125;,<br>    &#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">loadingMask</span>(&#123;<br>      <span class="hljs-attr">el</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>),<br>      <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;&#125;,<br>    &#125;);<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeScreenLock</span> = (<span class="hljs-params">isLockLoadDom, isLock</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (!isLockLoadDom) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 如果不是带有锁定滚动的loading，直接return</span><br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">overflow</span> = isLock ? <span class="hljs-string">&quot;hidden&quot;</span> : <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-keyword">if</span> (isLock) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<br>      <span class="hljs-string">&quot;touchmove&quot;</span>,<br>      <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;<br>        e.<span class="hljs-title function_">preventDefault</span>();<br>      &#125;,<br>      <span class="hljs-literal">false</span><br>    );<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<br>      <span class="hljs-string">&quot;touchmove&quot;</span>,<br>      <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;<br>        e.<span class="hljs-title function_">preventDefault</span>();<br>      &#125;,<br>      <span class="hljs-literal">false</span><br>    );<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeParentDomPosition</span> = (<span class="hljs-params">el, isShow</span>) =&gt; &#123;<br>  el.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = isShow ? <span class="hljs-string">&quot;relative&quot;</span> : <span class="hljs-string">&quot;static&quot;</span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-comment">// 初始化绑定(el：父元素，binding：参数)</span><br>  <span class="hljs-attr">inserted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">el, binding</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;el: &quot;</span>, el);<br>    <span class="hljs-keyword">const</span> &#123; fullscreen, lock &#125; = binding?.<span class="hljs-property">modifiers</span>;<br>    <span class="hljs-keyword">let</span> mask = <span class="hljs-title function_">createMask</span>(fullscreen);<br>    <span class="hljs-keyword">if</span> (!fullscreen) &#123;<br>      <span class="hljs-title function_">changeParentDomPosition</span>(el, <span class="hljs-literal">true</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">changeScreenLock</span>(lock, <span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(el, &#123;<br>      <span class="hljs-attr">instance</span>: mask,<br>      <span class="hljs-attr">mask</span>: mask.<span class="hljs-property">$el</span>,<br>    &#125;);<br>    binding.<span class="hljs-property">value</span> &amp;&amp; <span class="hljs-title function_">toggleLoading</span>(el, binding);<br>  &#125;,<br>  <span class="hljs-comment">// 数据更新</span><br>  <span class="hljs-attr">update</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">el, binding</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; fullscreen, lock &#125; = binding?.<span class="hljs-property">modifiers</span>;<br>    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">oldValue</span> !== binding.<span class="hljs-property">value</span>) &#123;<br>      <span class="hljs-title function_">toggleLoading</span>(el, binding);<br>      <span class="hljs-keyword">if</span> (!fullscreen) &#123;<br>        <span class="hljs-title function_">changeParentDomPosition</span>(el, <span class="hljs-literal">false</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">changeScreenLock</span>(lock, <span class="hljs-literal">false</span>);<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-comment">// 离开销毁</span><br>  <span class="hljs-attr">unbind</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) &#123;<br>    el.<span class="hljs-property">instance</span> &amp;&amp; el.<span class="hljs-property">instance</span>.$destroy();<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h4 id="loading-样式"><a href="#loading-样式" class="headerlink" title="loading 样式"></a>loading 样式</h4><ol>
<li><p>initPageLoading.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div<br>    :class=&quot;[visible ? &#x27;visibility opacity1&#x27; : &#x27;un-visibility opacity0&#x27;]&quot;<br>    class=&quot;svg-container flex-center z-100&quot;<br>  &gt;<br>    &lt;svg width=&quot;100%&quot; height=&quot;100%&quot;&gt;<br>      &lt;text<br>        v-for=&quot;item in 3&quot;<br>        :key=&quot;item&quot;<br>        text-anchor=&quot;middle&quot;<br>        x=&quot;50%&quot;<br>        y=&quot;50%&quot;<br>        class=&quot;loading-text&quot;<br>        :class=&quot;`loading-text-$&#123;item&#125;`&quot;<br>        dominant-baseline=&quot;middle&quot;<br>      &gt;<br>        &#123;&#123; loadingText &#125;&#125;<br>      &lt;/text&gt;<br>    &lt;/svg&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br> <span class="hljs-keyword">return</span> &#123;<br>   <span class="hljs-attr">loadingText</span>: <span class="hljs-string">&quot;KIVI CUBE&quot;</span>,<br>   <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span>,<br> &#125;;<br>&#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;style scoped lang=&quot;scss&quot;&gt;<br><span class="hljs-selector-class">.svg-container</span> &#123;<br>  <span class="hljs-attribute">position</span>: fixed;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">background-color</span>: white;<br>  <span class="hljs-attribute">transition</span>: all $el_entering_duration ease-out;<br>&#125;<br><br><span class="hljs-selector-class">.loading-text</span> &#123;<br>  <span class="hljs-attribute">animation</span>: stroke <span class="hljs-number">6s</span> infinite linear;<br>  fill: none;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">48px</span>;<br>  <span class="hljs-attribute">font-weight</span>: bold;<br>  <span class="hljs-attribute">letter-spacing</span>: <span class="hljs-number">3px</span>;<br>  stroke-dasharray: <span class="hljs-number">130</span> <span class="hljs-number">270</span>;<br>  stroke-<span class="hljs-attribute">width</span>: <span class="hljs-number">2px</span>;<br>  <span class="hljs-attribute">text-transform</span>: uppercase;<br>&#125;<br><br><span class="hljs-selector-class">.loading-text-1</span> &#123;<br>  <span class="hljs-attribute">animation-delay</span>: -<span class="hljs-number">2s</span>;<br>  stroke: <span class="hljs-number">#15c993</span>;<br>  <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-number">#15c993</span>;<br>&#125;<br><br><span class="hljs-selector-class">.loading-text-2</span> &#123;<br>  <span class="hljs-attribute">animation-delay</span>: -<span class="hljs-number">4s</span>;<br>  stroke: <span class="hljs-number">#04adc0</span>;<br>  <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-number">#04adc0</span>;<br>&#125;<br><br><span class="hljs-selector-class">.loading-text-3</span> &#123;<br>  <span class="hljs-attribute">animation-delay</span>: -<span class="hljs-number">6s</span>;<br>  stroke: <span class="hljs-number">#3ce7d0</span>;<br>  <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-number">#3ce7d0</span>;<br>&#125;<br><br><span class="hljs-keyword">@keyframes</span> stroke &#123;<br>  <span class="hljs-number">100%</span> &#123;<br>    stroke-dashoffset: -<span class="hljs-number">400</span>;<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure></li>
<li><p>normalLoading.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div<br>    :class=&quot;[visible ? &#x27;visibility opacity1&#x27; : &#x27;un-visibility opacity0&#x27;]&quot;<br>    class=&quot;svg-warp-container flex-center z-1&quot;<br>  &gt;<br>    &lt;div class=&quot;svg-container&quot;&gt;<br>      &lt;svg&gt;<br>        &lt;circle<br>          class=&quot;loading-inner&quot;<br>          cx=&quot;25&quot;<br>          cy=&quot;25&quot;<br>          r=&quot;20&quot;<br>          fill=&quot;none&quot;<br>          stroke=&quot;#00b2f8&quot;<br>          stroke-width=&quot;3&quot;<br>          stroke-linecap=&quot;round&quot;<br>        /&gt;<br>      &lt;/svg&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span>,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;style scoped lang=&quot;scss&quot;&gt;<br><span class="hljs-selector-class">.svg-warp-container</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>($color: <span class="hljs-number">#fff</span>, $alpha: <span class="hljs-number">0.9</span>);<br>  <span class="hljs-attribute">transition</span>: all $el_entering_duration ease-out;<br><br>  <span class="hljs-selector-class">.svg-container</span> &#123;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-selector-class">.loading-inner</span> &#123;<br>  <span class="hljs-attribute">animation</span>: kf-inner <span class="hljs-number">1.5s</span> ease-in-out infinite;<br>&#125;<br><br><span class="hljs-keyword">@keyframes</span> kf-inner &#123;<br>  <span class="hljs-number">0%</span> &#123;<br>    stroke-dasharray: <span class="hljs-number">1</span>, <span class="hljs-number">125</span>;<br>    stroke-dashoffset: <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-number">50%</span> &#123;<br>    stroke-dasharray: <span class="hljs-number">100</span>, <span class="hljs-number">125</span>;<br>    stroke-dashoffset: -<span class="hljs-number">25px</span>;<br>  &#125;<br><br>  <span class="hljs-number">100%</span> &#123;<br>    stroke-dasharray: <span class="hljs-number">100</span>, <span class="hljs-number">125</span>;<br>    stroke-dashoffset: -<span class="hljs-number">125px</span>;<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="main-js-中引用自定义指令"><a href="#main-js-中引用自定义指令" class="headerlink" title="main.js 中引用自定义指令"></a>main.js 中引用自定义指令</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> directive <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/directive/index&quot;</span>;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(directive);<br></code></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pc-bg&quot;</span> <span class="hljs-attr">v-loading.fullscreen.lock</span>=<span class="hljs-string">&quot;fullscreenLoading&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pc-bg&quot;</span> <span class="hljs-attr">v-loading</span>=<span class="hljs-string">&quot;loading&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h3><h4 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">ARScenesList</span> = [<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s0.jpg&quot;</span>),<br>       &#125;,<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s1.jpg&quot;</span>),<br>       &#125;,<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s2.jpg&quot;</span>),<br>       &#125;,<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s3.jpg&quot;</span>),<br>       &#125;,<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s4.jpg&quot;</span>),<br>       &#125;,<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s5.jpg&quot;</span>),<br>       &#125;,<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">6</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s6.jpg&quot;</span>),<br>       &#125;,<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">7</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s7.jpg&quot;</span>),<br>       &#125;,<br>       &#123;<br>         <span class="hljs-attr">id</span>: <span class="hljs-number">8</span>,<br>         <span class="hljs-attr">src</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@img/pages/home/making-step/s8.jpg&quot;</span>),<br>       &#125;,<br>     ],<br></code></pre></td></tr></table></figure>

<h4 id="改造携带-order"><a href="#改造携带-order" class="headerlink" title="改造携带 order"></a>改造携带 order</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> finalVideo = <span class="hljs-title function_">deepClone</span>(<span class="hljs-title class_">ARScenesList</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">e, index</span>) =&gt;</span> &#123;<br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(e, &#123;<br>    <span class="hljs-attr">order</span>: index,<br>  &#125;);<br>  <span class="hljs-keyword">return</span> e;<br>&#125;);<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">videosWithOrder</span>.<span class="hljs-title function_">push</span>(...finalVideo);<br></code></pre></td></tr></table></figure>

<h4 id="渲染数据"><a href="#渲染数据" class="headerlink" title="渲染数据"></a>渲染数据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div<br>    v-for=&quot;(video, index) in videosWithOrder&quot;<br>    :key=&quot;index&quot;<br>    :style=&quot;checkVideoStyle(video, index)&quot;<br>    @click=&quot;clickCurrentVideo(video, index)&quot;<br>  &gt;<br>    &lt;img<br>      class=&quot;single-carousel-image pointer&quot;<br>      :src=&quot;video.src&quot;<br>      :alt=&quot;$t(&#x27;components.VideoCarousel.videoPoster&#x27;)&quot;<br>    /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>

<h4 id="生成位置样式"><a href="#生成位置样式" class="headerlink" title="生成位置样式"></a>生成位置样式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script&gt;<br> computed: &#123;<br>  checkVideoStyle() &#123;<br>    return (video, renderIndex) =&gt; &#123;<br>      const positionList = [];<br>      const videosWithOrderLength = this.videosWithOrder.length - 1;<br>      const middleNumber = getMiddleNumber(videosWithOrderLength);<br>      this.videosWithOrder.forEach((e, index) =&gt; &#123;<br>        positionList.push(<br>          this.generateTransformNumberX(<br>            index,<br>            middleNumber,<br>            video.order,<br>            renderIndex<br>          )<br>        );<br>      &#125;);<br>       const offsetX = positionList[video.order];<br>      const offsetY = 0;<br>      let style = &#123;<br>        transform: `scale(1) translate3d($&#123;offsetX&#125;%, $&#123;offsetY&#125;, 0)`,<br>      &#125;;<br>      return style;<br>    &#125;;<br>  &#125;,<br>&#125;,<br>  methods: &#123;<br>    generateTransformNumberX(index, middleNumber, order) &#123;<br>      let transformNumberX = 0;<br>      if (this.type === &quot;card&quot;) &#123;<br>        // pc端卡片式轮播图<br>        const singleSpacing = 100 + 13; // 单个间距<br>        const scaleSpacing = 17; // 缩放导致初始位置靠右,需减去误差<br>        transformNumberX = index * singleSpacing - scaleSpacing;<br>        if (index &gt;= middleNumber) &#123;<br>          transformNumberX += 40;<br>        &#125;<br>      &#125;<br>      return transformNumberX;<br>    &#125;,<br>     clickCurrentVideo(item, index) &#123;<br>      if (index !== this.currentPlayingVideoIndex) &#123;<br>        this.transformDirection = &quot;rightToLeft&quot;;<br>        this.currentPlayingVideoIndex = index;<br>        this.changeVideoOrderThenPlay(<br>          item?.order,<br>          this.currentPlayingVideoIndex<br>        );<br>      &#125;<br>    &#125;,<br>   changeVideoOrderThenPlay(clickOrder, currentPlayingVideoIndex) &#123;<br>       const middleIndex = getMiddleNumber(this.videosWithOrder?.length - 1)<br>      const switchStep = middleIndex - clickOrder;<br>      const totalVideoLength = this.videosWithOrder?.length;<br>      this.videosWithOrder.forEach((e) =&gt; &#123;<br>        if (<br>          e.order + switchStep &gt;= 0 &amp;&amp;<br>          e.order + switchStep &lt;= totalVideoLength - 1<br>        ) &#123;<br>          e.order += switchStep;<br>        &#125; else if (e.order + switchStep &lt; 0) &#123;<br>          e.order = e.order + totalVideoLength + switchStep;<br>        &#125; else if (e.order + switchStep &gt; totalVideoLength - 1) &#123;<br>          e.order = e.order - totalVideoLength + switchStep;<br>        &#125;<br>      &#125;);<br>     &#125;,<br>    getMiddleNumber(totalNumber)  &#123;<br>     if (typeof totalNumber === &quot;number&quot;) &#123;<br>       return Math.ceil(totalNumber / 2);<br>     &#125;<br>&#125;<br>  &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h3 id="样式或者-vue-中写法的记录问题贴"><a href="#样式或者-vue-中写法的记录问题贴" class="headerlink" title="样式或者 vue 中写法的记录问题贴"></a>样式或者 vue 中写法的记录问题贴</h3><p>这个里主要是关于样式中的坑和 vue 中一些特定写法的记录，统一放入这个帖子中，方便查询</p>
<p><strong>vue 中直接在 style 中进行判断</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tag</span></span><br><span class="hljs-tag">  <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#x27;backgroundColor:white;marginLeft:20px;border:none;marginRight:20px;fontSize:14px;color:&#x27;+ (isEdit == true ? &#x27;black&#x27;: &#x27;lightgrey&#x27;) +&#x27;&#x27;&quot;</span></span><br><span class="hljs-tag">  &gt;</span>是否续订:&lt;/el-tag<br>&gt;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>外部用“”，内部还需要用‘’包裹，然后再内部使用拼接的写法，同时判断这个条件，还需要用括号包裹起来，并且，对应的值，也需要用‘’包裹起来。</p>
</blockquote>
<h3 id="Array-apply-null-length-20-和-new-Array-20"><a href="#Array-apply-null-length-20-和-new-Array-20" class="headerlink" title="Array.apply(null, { length: 20 }) 和 new Array(20)"></a><strong>Array.apply(null, { length: 20 }) 和 new Array(20)</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">render</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">createElement</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>,<br>    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, &#123; <span class="hljs-attr">length</span>: <span class="hljs-number">20</span> &#125;).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;hi&#x27;</span>)<br>    &#125;)<br>  )<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>Array.apply(null, { length: 20 }) 生成的数组形式为[undifiend,undifiend,undifiend,…..],</p>
<p>new Array(20)等价于[，，，，]</p>
</blockquote>
<p>后面使用.map 方法的时候，map 方法的限制为：map 函数并不会遍历数组中没有初始化或者被 delete 的元素（有相同限制还有 forEach, reduce 方法）。而 new Array 并没有初始化。所以，需要采用官方的写法。</p>
<h3 id="ES6-新方法"><a href="#ES6-新方法" class="headerlink" title="ES6 新方法"></a>ES6 新方法</h3><p><strong>使用 reduce 取代 map 和 filter</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> num = [<span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>];<br><span class="hljs-keyword">let</span> doubleNum = num.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">finalNum, num</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> numTem = num * <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">if</span> (numTem &gt; <span class="hljs-number">50</span>) &#123;<br>    finalNum.<span class="hljs-title function_">push</span>(numTem);<br>  &#125;<br>  <span class="hljs-keyword">return</span> finalNum;<br>&#125;, []);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doubleNum);<br></code></pre></td></tr></table></figure>

<p><strong>统计数组中相同项的个数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> name = [<span class="hljs-string">&quot;tom&quot;</span>, <span class="hljs-string">&quot;jerry&quot;</span>, <span class="hljs-string">&quot;tony&quot;</span>, <span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-string">&quot;tony&quot;</span>, <span class="hljs-string">&quot;jack&quot;</span>];<br><span class="hljs-keyword">let</span> nameAsiys = name.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">nameObject, object</span>) =&gt;</span> &#123;<br>  nameObject[object] = nameObject[object] ? ++nameObject[object] : <span class="hljs-number">1</span>;<br>&#125;, &#123;&#125;);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nameAsiys);<br></code></pre></td></tr></table></figure>

<p><strong>删除不需要的属性</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> &#123; _lee, _meng, ...others &#125; = &#123;<br>  <span class="hljs-attr">_lee</span>: <span class="hljs-string">&quot;first&quot;</span>,<br>  <span class="hljs-attr">_meng</span>: <span class="hljs-string">&quot;last&quot;</span>,<br>  <span class="hljs-attr">object1</span>: <span class="hljs-string">&quot;111&quot;</span>,<br>  <span class="hljs-attr">object2</span>: <span class="hljs-string">&quot;222&quot;</span>,<br>  <span class="hljs-attr">object3</span>: <span class="hljs-string">&quot;333&quot;</span>,<br>  <span class="hljs-attr">object4</span>: <span class="hljs-string">&quot;444&quot;</span>,<br>&#125;;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(others);<br></code></pre></td></tr></table></figure>

<p><strong>在函数参数中解构嵌套对象</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> originObject = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;lee&quot;</span>,<br>  <span class="hljs-attr">test</span>: &#123;<br>    <span class="hljs-attr">origin</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-attr">fix</span>: <span class="hljs-string">&quot;3&quot;</span>,<br>    <span class="hljs-attr">bug</span>: <span class="hljs-string">&quot;555&quot;</span>,<br>  &#125;,<br>&#125;;<br><span class="hljs-keyword">let</span> &#123;<br>  name,<br>  <span class="hljs-attr">test</span>: &#123; bug &#125;,<br>&#125; = originObject;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name, bug);<br></code></pre></td></tr></table></figure>

<p><strong>数组对象去重</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> person = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小明&quot;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小张&quot;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小李&quot;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小孙&quot;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小周&quot;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小陈&quot;</span> &#125;,<br>];<br><span class="hljs-keyword">let</span> personTem = &#123;&#125;;<br><span class="hljs-keyword">let</span> finalList = person.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">personList, element</span>) =&gt;</span> &#123;<br>  personTem[element.<span class="hljs-property">id</span>]<br>    ? <span class="hljs-string">&quot;&quot;</span><br>    : (personTem[element.<span class="hljs-property">id</span>] = <span class="hljs-literal">true</span> &amp;&amp; personList.<span class="hljs-title function_">push</span>(element));<br>  <span class="hljs-keyword">return</span> personList;<br>&#125;, []);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(finalList);<br></code></pre></td></tr></table></figure>

<h3 id="监听页面离开和返回"><a href="#监听页面离开和返回" class="headerlink" title="监听页面离开和返回"></a>监听页面离开和返回</h3><p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/11/page_lifecycle_api.html">监听页面离开和返回</a></p>
<h3 id="可能用到的请求和下载"><a href="#可能用到的请求和下载" class="headerlink" title="可能用到的请求和下载"></a>可能用到的请求和下载</h3><h4 id="vue-中的-axios-请求"><a href="#vue-中的-axios-请求" class="headerlink" title="vue 中的 axios 请求"></a>vue 中的 axios 请求</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>;<br><span class="hljs-keyword">const</span> host = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./host&quot;</span>);<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Message</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;element-ui&quot;</span>;<br><br><span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-attr">baseURL</span>: host.<span class="hljs-property">host</span>,<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">60000000</span>,<br>&#125;);<br><br>service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> token = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;token&quot;</span>);<br><br>    config.<span class="hljs-property">headers</span> = token<br>      ? &#123; <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">&quot;Bearer &quot;</span> + sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;token&quot;</span>) &#125;<br>      : <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">ContentType</span>) &#123;<br>      config.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;Content-Type&quot;</span>] = config.<span class="hljs-property">ContentType</span>;<br>      <span class="hljs-keyword">delete</span> config.<span class="hljs-property">ContentType</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<br>      <span class="hljs-comment">//本地环境情况下，需要把login的host写死。避免频繁的切换host</span><br>      process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_DEBUG</span> === <span class="hljs-string">&quot;development&quot;</span> &amp;&amp;<br>      config.<span class="hljs-property">url</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;?&quot;</span>)[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;/admin/login&quot;</span><br>    ) &#123;<br>      config.<span class="hljs-property">baseURL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_HOST</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">//测试环境或者正式环境，需要将所有的host改成环境文件中的host</span><br>      <span class="hljs-keyword">switch</span> (config.<span class="hljs-property">basicUrl</span>) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;/mall&quot;</span>:<br>          config.<span class="hljs-property">baseURL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_HOST1</span>;<br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-attr">default</span>:<br>          config.<span class="hljs-property">baseURL</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_HOST</span>;<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> config;<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>();<br>  &#125;<br>);<br><br>service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">data</span>.<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title class_">Message</span>(&#123;<br>          <span class="hljs-attr">message</span>: response.<span class="hljs-property">data</span>.<span class="hljs-property">msg</span>,<br>          <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>          <span class="hljs-attr">duration</span>: <span class="hljs-number">2</span> * <span class="hljs-number">1000</span>,<br>        &#125;);<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>();<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>();<br>    &#125;<br>  &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(error).<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;Network Error&quot;</span>)) &#123;<br>      <span class="hljs-title class_">Message</span>(&#123;<br>        <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;网络出错了,请检查网络&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-number">2</span> * <span class="hljs-number">1000</span>,<br>      &#125;);<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span> === <span class="hljs-number">500</span> || error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span> === <span class="hljs-number">403</span>) &#123;<br>      <span class="hljs-title class_">Message</span>(&#123;<br>        <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;登录已失效，请重新登录&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-number">2</span> * <span class="hljs-number">1000</span>,<br>      &#125;);<br>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&quot;resources&quot;</span>);<br>        sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&quot;token&quot;</span>);<br>        sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&quot;adminUserInfo&quot;</span>);<br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> =<br>          process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&quot;development&quot;</span><br>            ? <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">protocol</span> +<br>              <span class="hljs-string">&quot;//&quot;</span> +<br>              <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">host</span> +<br>              <span class="hljs-string">&quot;/#/login&quot;</span><br>            : <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">protocol</span> +<br>              <span class="hljs-string">&quot;//&quot;</span> +<br>              <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">host</span> +<br>              process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_PUBLIC</span> +<br>              <span class="hljs-string">&quot;#/login&quot;</span>;<br>      &#125;, <span class="hljs-number">2000</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<br>      error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span> === <span class="hljs-string">&quot;The service or item was not found.&quot;</span><br>    ) &#123;<br>      <span class="hljs-title class_">Message</span>(&#123;<br>        <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;平台升级中...&quot;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-number">2</span> * <span class="hljs-number">1000</span>,<br>      &#125;);<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title class_">Message</span>(&#123;<br>        <span class="hljs-attr">message</span>: error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-number">2</span> * <span class="hljs-number">1000</span>,<br>      &#125;);<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>    &#125;<br>  &#125;<br>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> service;<br></code></pre></td></tr></table></figure>

<h4 id="uni-中的请求"><a href="#uni-中的请求" class="headerlink" title="uni 中的请求"></a>uni 中的请求</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; browser, <span class="hljs-title class_">Phone</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/net.js&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">request</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">config</span>) =&gt; &#123;<br>  <span class="hljs-comment">// ****************APP打包请求url配置****************</span><br>  <span class="hljs-comment">//   @当APP进行打包后，从process.env.NODE_ENV获取得到的总是&#x27;production&#x27;，需要新加一种手动控制url的字段，by:李蒙</span><br><br>  <span class="hljs-comment">// let currentEnv = &#x27;development&#x27; //打包APP时使用测试地址</span><br>  <span class="hljs-keyword">let</span> currentEnv = <span class="hljs-string">&quot;production&quot;</span>; <span class="hljs-comment">//打包APP时使用正式地址</span><br>  <span class="hljs-keyword">if</span> (!uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;currentEnv&quot;</span>))<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;currentEnv&quot;</span>, currentEnv);<br>  <span class="hljs-comment">// ****************APP打包请求url配置****************</span><br><br>  <span class="hljs-keyword">let</span> baseUrlDev = <span class="hljs-string">&quot;http://wx.114family.cn/family-iface-dev&quot;</span>; <span class="hljs-comment">//默认请求</span><br>  <span class="hljs-keyword">let</span> bseUrlPro = <span class="hljs-string">&quot;https://wechat.114family.cn/family-iface&quot;</span>; <span class="hljs-comment">//默认请求</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">WXbaseUrlDev</span> = <span class="hljs-string">&quot;http://wx.114family.cn/family-iface-tiny-dev&quot;</span>; <span class="hljs-comment">//微店请求</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">WXbaseUrlPro</span> = <span class="hljs-string">&quot;https://wechat.114family.cn/family-iface-tiny&quot;</span>; <span class="hljs-comment">//微店请求</span><br>  <span class="hljs-keyword">let</span> isDev = currentEnv == <span class="hljs-string">&quot;production&quot;</span>; <span class="hljs-comment">//true为正式环境，false为测试环境</span><br><br>  <span class="hljs-comment">// 1.对基础url进行逻辑判断</span><br>  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">isV</span>) &#123;<br>    <span class="hljs-comment">//是否是微店请求</span><br>    config.<span class="hljs-property">url</span> = isDev ? <span class="hljs-title class_">WXbaseUrlPro</span> + config.<span class="hljs-property">url</span> : <span class="hljs-title class_">WXbaseUrlDev</span> + config.<span class="hljs-property">url</span>;<br>    <span class="hljs-keyword">if</span> (!uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;__urlisV__&quot;</span>)) &#123;<br>      uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;__urlisV__&quot;</span>, isDev ? <span class="hljs-title class_">WXbaseUrlPro</span> : <span class="hljs-title class_">WXbaseUrlDev</span>);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config.<span class="hljs-property">isPay</span>) &#123;<br>    <span class="hljs-comment">//是否是支付请求</span><br>    config.<span class="hljs-property">url</span> =<br>      <span class="hljs-string">&quot;https://share.qingmh.com/wechat-pay-common/wechatpay/hjt/create&quot;</span>;<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config.<span class="hljs-property">isPayQuery</span>) &#123;<br>    <span class="hljs-comment">// 是否是支付结果查询接口</span><br>    config.<span class="hljs-property">url</span> =<br>      <span class="hljs-string">&quot;https://share.qingmh.com/wechat-pay-common/wechatpay/order/query&quot;</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">//默认请求</span><br>    config.<span class="hljs-property">url</span> = isDev ? bseUrlPro + config.<span class="hljs-property">url</span> : baseUrlDev + config.<span class="hljs-property">url</span>;<br>    <span class="hljs-keyword">if</span> (!uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;url&quot;</span>)) &#123;<br>      uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;url&quot;</span>, isDev ? bseUrlPro : baseUrlDev);<br>    &#125;<br>  &#125;<br>  config.<span class="hljs-property">header</span> = &#123;<br>    <span class="hljs-attr">region</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-attr">terminalcode</span>: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// 设备号,PC端传浏览器版本号</span><br>    <span class="hljs-attr">terminaltype</span>: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// 端口类型，例如 APP,XCX,WECHAT,WEB</span><br>    <span class="hljs-attr">stoken</span>: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">// 授权</span><br>    <span class="hljs-attr">devicetype</span>: <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">//所属平台,例如 IOS,ANDROID,XCX,WECHAT,WEB(浏览器名称)</span><br>  &#125;;<br><br>  <span class="hljs-comment">//region :lat	是	string纬度,lng	是	string经度,province	是	string省,city	是	string市,district	否	string区县,</span><br>  <span class="hljs-comment">//street	否	string街道,street_number	否	string街道号</span><br>  <span class="hljs-keyword">let</span> platform = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;platform&quot;</span>); <span class="hljs-comment">// 机型</span><br>  <span class="hljs-keyword">let</span> stoken = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;stoken&quot;</span>); <span class="hljs-comment">// 获取后台反的token</span><br>  <span class="hljs-keyword">let</span> isfirstGetSysInfo = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;firstGetSysInfo&quot;</span>); <span class="hljs-comment">//判断是否已经获取了设备的信息(某些浏览器，无法在第一次打开时获取信息，所以额外的添加了字段)</span><br>  <span class="hljs-comment">// 2.对提供的options进行逻辑判断</span><br>  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">needToken</span>) &#123;<br>    <span class="hljs-comment">//当前请求是否需要token</span><br>    <span class="hljs-keyword">if</span> (stoken == <span class="hljs-string">&quot;&quot;</span> || stoken == <span class="hljs-literal">null</span> || stoken == <span class="hljs-literal">undefined</span> || !stoken) &#123;<br>      <span class="hljs-comment">//当请求中没有token时，直接跳到登录页，by：李蒙</span><br>      uni.<span class="hljs-title function_">reLaunch</span>(&#123;<br>        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/pages/Login/otherLogin&quot;</span>,<br>      &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">const</span> region = &#123;<br>        <span class="hljs-attr">lat</span>: <span class="hljs-string">&quot;30.680905&quot;</span>,<br>        <span class="hljs-attr">lng</span>: <span class="hljs-string">&quot;104.117462&quot;</span>,<br>        <span class="hljs-attr">province</span>: <span class="hljs-string">&quot;四川省&quot;</span>,<br>        <span class="hljs-attr">city</span>: <span class="hljs-string">&quot;成都市&quot;</span>,<br>      &#125;;<br>      <span class="hljs-comment">// if (uni.getStorageSync(&#x27;region&#x27;)) &#123;</span><br>      <span class="hljs-comment">//   let regData = JSON.parse(uni.getStorageSync(&#x27;region&#x27;))</span><br>      <span class="hljs-comment">//   region = &#123; ...region, ...regData &#125;</span><br>      <span class="hljs-comment">// &#125;</span><br><br>      <span class="hljs-comment">// config.header.region = encodeURIComponent(JSON.stringify(region))</span><br>      config.<span class="hljs-property">header</span>.<span class="hljs-property">stoken</span> = stoken;<br>    &#125;<br>  &#125;<br>  <span class="hljs-comment">//新增请求头内的devicetype等信息</span><br>  <span class="hljs-keyword">if</span> (isfirstGetSysInfo == <span class="hljs-string">&quot;done&quot;</span>) &#123;<br>    <span class="hljs-comment">//获取了手机系统信息</span><br>    config.<span class="hljs-property">header</span>.<span class="hljs-property">terminalcode</span> = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;model&quot;</span>);<br>    config.<span class="hljs-property">header</span>.<span class="hljs-property">terminaltype</span> = <span class="hljs-string">&quot;WAP&quot;</span>;<br>    config.<span class="hljs-property">header</span>.<span class="hljs-property">devicetype</span> = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;platform&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">//未获取手机系统信息</span><br>    <span class="hljs-keyword">let</span> getSystemInfoSync = <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">getSystemInfoSync</span>();<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;firstGetSysInfo&quot;</span>, <span class="hljs-string">&quot;done&quot;</span>);<br>    <span class="hljs-keyword">let</span> devicetypeTem = <span class="hljs-string">&quot;android&quot;</span>;<br>    <span class="hljs-keyword">let</span> modelTem = <span class="hljs-string">&quot;WAP&quot;</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(getSystemInfoSync, <span class="hljs-string">&quot;2222222&quot;</span>);<br>    <span class="hljs-keyword">if</span> (getSystemInfoSync &amp;&amp; getSystemInfoSync.<span class="hljs-property">platform</span> == <span class="hljs-string">&quot;other&quot;</span>) &#123;<br>      <span class="hljs-comment">//当使用wap开发时，有可能获取不到系统信息，改用navigator.userAgent</span><br>      <span class="hljs-keyword">let</span> ua = <span class="hljs-title function_">browser</span>();<br>      <span class="hljs-keyword">let</span> phone = <span class="hljs-title class_">Phone</span>();<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ua, phone, <span class="hljs-string">&quot;获取的浏览器数据&quot;</span>);<br>      config.<span class="hljs-property">header</span>.<span class="hljs-property">terminalcode</span> = ua.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;/&quot;</span>) &amp;&amp; ua.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;/&quot;</span>)[<span class="hljs-number">0</span>];<br>      config.<span class="hljs-property">header</span>.<span class="hljs-property">terminaltype</span> = <span class="hljs-string">&quot;WAP&quot;</span>;<br>      config.<span class="hljs-property">header</span>.<span class="hljs-property">devicetype</span> = phone;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      devicetypeTem =<br>        getSystemInfoSync.<span class="hljs-property">platform</span> == <span class="hljs-string">&quot;devtools&quot;</span><br>          ? <span class="hljs-string">&quot;ios&quot;</span><br>          : getSystemInfoSync.<span class="hljs-property">platform</span>;<br>      modelTem = getSystemInfoSync.<span class="hljs-property">model</span> ? getSystemInfoSync.<span class="hljs-property">model</span> : <span class="hljs-string">&quot;android&quot;</span>;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(modelTem, <span class="hljs-string">&quot;1111&quot;</span>);<br>    config.<span class="hljs-property">header</span>.<span class="hljs-property">terminalcode</span> = modelTem;<br>    config.<span class="hljs-property">header</span>.<span class="hljs-property">terminaltype</span> = <span class="hljs-string">&quot;WAP&quot;</span>;<br>    config.<span class="hljs-property">header</span>.<span class="hljs-property">devicetype</span> = devicetypeTem;<br>    <span class="hljs-comment">//本地存储，后续可能会用到</span><br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;model&quot;</span>, modelTem);<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;platform&quot;</span>, devicetypeTem);<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;windowWidth&quot;</span>, getSystemInfoSync.<span class="hljs-property">windowWidth</span>);<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;windowHeight&quot;</span>, getSystemInfoSync.<span class="hljs-property">windowHeight</span>);<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;safeAreaH&quot;</span>, getSystemInfoSync.<span class="hljs-property">safeArea</span>.<span class="hljs-property">height</span>);<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;safeAreaT&quot;</span>, getSystemInfoSync.<span class="hljs-property">safeArea</span>.<span class="hljs-property">top</span>);<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;statusBarHeight&quot;</span>, getSystemInfoSync.<span class="hljs-property">statusBarHeight</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">data</span>) &#123;<br>    config.<span class="hljs-property">data</span> = &#123;&#125;;<br>  &#125;<br>  <span class="hljs-comment">//存储一下configHeaderInfo,当你跳转到图文海报的h5的时候，需要将header做一个替换</span><br>  <span class="hljs-keyword">if</span> (!uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&quot;configHeaderInfo&quot;</span>))<br>    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">&quot;configHeaderInfo&quot;</span>, config.<span class="hljs-property">header</span>);<br>  <span class="hljs-comment">//   console.log(config, &#x27;*****请求中携带的参数********&#x27;)</span><br>  <span class="hljs-comment">// 3.将已经配置好的uni.request作为一个promise返回</span><br>  <span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    uni<br>      .<span class="hljs-title function_">request</span>(config)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">responses</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(responses, <span class="hljs-string">&quot;返回的数据&quot;</span>);<br>        <span class="hljs-keyword">if</span> (responses[<span class="hljs-number">0</span>]) &#123;<br>          <span class="hljs-comment">//   if (uni.getStorageSync(&#x27;firstLogin&#x27;)) &#123;</span><br>          <span class="hljs-comment">//     reject(&#123; message: &#x27;网络超时&#x27; &#125;)</span><br>          <span class="hljs-comment">//   &#125; else &#123;</span><br>          uni.<span class="hljs-title function_">clearStorageSync</span>();<br>          uni.<span class="hljs-title function_">reLaunch</span>(&#123;<br>            <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/pages/Login/otherLogin&quot;</span>,<br>          &#125;);<br>          <span class="hljs-comment">//   &#125;</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">let</span> response = responses[<span class="hljs-number">1</span>].<span class="hljs-property">data</span>; <span class="hljs-comment">// 如果返回的结果是data.data的，嫌麻烦可以用这个，return res,这样只返回一个data</span><br>          <span class="hljs-keyword">if</span> (<br>            (response.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;0016&quot;</span> &amp;&amp; response.<span class="hljs-property">message</span> === <span class="hljs-string">&quot;口令认证失败&quot;</span>) ||<br>            response.<span class="hljs-property">code</span> === <span class="hljs-string">&quot;00909&quot;</span> ||<br>            response.<span class="hljs-property">message</span> === <span class="hljs-string">&quot;网络超时&quot;</span><br>          ) &#123;<br>            uni.<span class="hljs-title function_">clearStorageSync</span>();<br>            uni.<span class="hljs-title function_">reLaunch</span>(&#123;<br>              <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/pages/Login/otherLogin&quot;</span>,<br>              <span class="hljs-title function_">fail</span>(<span class="hljs-params">e</span>) &#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);<br>              &#125;,<br>            &#125;);<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;触发认证失败&quot;</span>, response);<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-title function_">resolve</span>(response);<br>          &#125;<br>        &#125;<br>      &#125;)<br>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>(error);<br>      &#125;);<br>  &#125;);<br>  <span class="hljs-keyword">return</span> promise;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> request;<br></code></pre></td></tr></table></figure>

<h4 id="下载-oss-地址文件"><a href="#下载-oss-地址文件" class="headerlink" title="下载 oss 地址文件"></a>下载 oss 地址文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">downLoadFile</span>(<span class="hljs-params">e</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e, <span class="hljs-string">&#x27;e&#x27;</span>)<br>      <span class="hljs-keyword">let</span> str = e.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">0</span>]<br>      <span class="hljs-comment">//   this.downloadByAxios(e.url, str)</span><br>      <span class="hljs-keyword">let</span> urlstr = e.<span class="hljs-property">url</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;http&#x27;</span>, <span class="hljs-string">&#x27;https&#x27;</span>)<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(urlstr, <span class="hljs-string">&#x27;urlstr&#x27;</span>)<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">download</span>(urlstr, str)<br>    &#125;,<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">download</span>(<span class="hljs-params">url, filename</span>) &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 下载</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span>  &#123;<span class="hljs-type">String</span>&#125; url 目标文件地址</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span>  &#123;<span class="hljs-type">String</span>&#125; filename 想要保存的文件名称</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBlob</span>(url, <span class="hljs-function">(<span class="hljs-params">blob</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveAs</span>(blob, filename)<br>  &#125;)<br>&#125;,<br><span class="hljs-title function_">getBlob</span>(<span class="hljs-params">url, cb</span>) &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 获取 blob</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span>  &#123;<span class="hljs-type">String</span>&#125; url 目标文件地址</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">cb</span>&#125;</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>()<br>  xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;GET&#x27;</span>, url, <span class="hljs-literal">true</span>)<br>  xhr.<span class="hljs-property">responseType</span> = <span class="hljs-string">&#x27;blob&#x27;</span><br>  xhr.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>      <span class="hljs-title function_">cb</span>(xhr.<span class="hljs-property">response</span>)<br>    &#125;<br>  &#125;<br>  xhr.<span class="hljs-title function_">send</span>()<br>&#125;,<br><span class="hljs-title function_">saveAs</span>(<span class="hljs-params">blob, filename</span>) &#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 保存</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span>  &#123;<span class="hljs-type">Blob</span>&#125; <span class="hljs-variable">blob</span></span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span>  &#123;<span class="hljs-type">String</span>&#125; filename 想要保存的文件名称</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">navigator</span>.<span class="hljs-property">msSaveOrOpenBlob</span>) &#123;<br>    navigator.<span class="hljs-title function_">msSaveBlob</span>(blob, filename)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">var</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br>    <span class="hljs-keyword">var</span> body = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;body&#x27;</span>)<br>    link.<span class="hljs-property">href</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob)<br>    link.<span class="hljs-property">download</span> = filename<br>    <span class="hljs-comment">// fix Firefox</span><br>    link.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">&#x27;none&#x27;</span><br>    body.<span class="hljs-title function_">appendChild</span>(link)<br>    link.<span class="hljs-title function_">click</span>()<br>    body.<span class="hljs-title function_">removeChild</span>(link)<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(link.<span class="hljs-property">href</span>)<br>  &#125;<br>&#125;,<br></code></pre></td></tr></table></figure>

<h4 id="下载服务器文件"><a href="#下载服务器文件" class="headerlink" title="下载服务器文件"></a>下载服务器文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportInfo</span>(<span class="hljs-params">info</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">axios</span>(&#123;<br>      <span class="hljs-attr">method</span>: info.<span class="hljs-property">method</span>,<br>      <span class="hljs-attr">url</span>: info.<span class="hljs-property">params</span> ? info.<span class="hljs-property">url</span> + <span class="hljs-title function_">setUrlParam</span>(info.<span class="hljs-property">params</span>) : info.<span class="hljs-property">url</span>,<br>      <span class="hljs-attr">data</span>: info.<span class="hljs-property">params</span>,<br>      <span class="hljs-attr">responseType</span>: info.<span class="hljs-property">responseType</span>, <span class="hljs-comment">// 优先尝试 blob</span><br>      <span class="hljs-attr">headers</span>: &#123;<br>        <span class="hljs-title class_">Authorization</span>: <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;token&quot;</span>)<br>          ? <span class="hljs-string">&quot;Bearer &quot;</span> + <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;token&quot;</span>)<br>          : <span class="hljs-string">&quot;&quot;</span>,<br>      &#125;,<br>    &#125;)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">let</span> objectUrl = <span class="hljs-literal">null</span>,<br>          blob = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (info.<span class="hljs-property">type</span> === <span class="hljs-string">&quot;excel&quot;</span>) &#123;<br>          blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([res.<span class="hljs-property">data</span>], &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;application/vnd.ms-excel&quot;</span>,<br>          &#125;);<br>          objectUrl = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (info.<span class="hljs-property">type</span> === <span class="hljs-string">&quot;img&quot;</span>) &#123;<br>          objectUrl =<br>            <span class="hljs-string">&quot;data:image/png;base64,&quot;</span> +<br>            <span class="hljs-title function_">btoa</span>(<br>              <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(res.<span class="hljs-property">data</span>).<span class="hljs-title function_">reduce</span>(<br>                <span class="hljs-function">(<span class="hljs-params">data, byte</span>) =&gt;</span> data + <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(byte),<br>                <span class="hljs-string">&quot;&quot;</span><br>              )<br>            );<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (info.<span class="hljs-property">type</span> === <span class="hljs-string">&quot;zip&quot;</span>) &#123;<br>          blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([res.<span class="hljs-property">data</span>], &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;application/zip&quot;</span> &#125;);<br>          objectUrl = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (info.<span class="hljs-property">type</span> === <span class="hljs-string">&quot;doc&quot;</span>) &#123;<br>          blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([res.<span class="hljs-property">data</span>], &#123;<br>            <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;application/msword&quot;</span>,<br>          &#125;);<br>          objectUrl = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);<br>        &#125;<br>        <span class="hljs-keyword">let</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;a&quot;</span>);<br>        a.<span class="hljs-property">href</span> = objectUrl;<br>        a.<span class="hljs-property">download</span> = info.<span class="hljs-property">name</span>;<br>        <span class="hljs-comment">//a.click();</span><br>        <span class="hljs-comment">//下面这个写法兼容火狐</span><br>        a.<span class="hljs-title function_">dispatchEvent</span>(<br>          <span class="hljs-keyword">new</span> <span class="hljs-title class_">MouseEvent</span>(<span class="hljs-string">&quot;click&quot;</span>, &#123;<br>            <span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">cancelable</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">view</span>: <span class="hljs-variable language_">window</span>,<br>          &#125;)<br>        );<br>        <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(blob);<br>        <span class="hljs-title function_">resolve</span>(res);<br>      &#125;)<br>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;response: &quot;</span>, error);<br>        <span class="hljs-title function_">reject</span>(error);<br>      &#125;);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="前端下载并打包-zip"><a href="#前端下载并打包-zip" class="headerlink" title="前端下载并打包 zip"></a>前端下载并打包 zip</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;script-loader!file-saver&quot;</span>);<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">JSZip</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;jszip&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">FileSaver</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;file-saver&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getFile</span> = (<span class="hljs-params">url</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>    xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>, url);<br>    xhr.<span class="hljs-property">responseType</span> = <span class="hljs-string">&quot;arraybuffer&quot;</span>;<br>    xhr.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-comment">/* handle errors*/</span><br>    &#125;;<br>    xhr.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-title function_">resolve</span>(xhr.<span class="hljs-property">response</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">reject</span>(&#123;&#125;);<br>      &#125;<br>    &#125;;<br>    xhr.<span class="hljs-title function_">send</span>();<br>  &#125;);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportZip</span>(<span class="hljs-params">data, zipName</span>) &#123;<br>  <span class="hljs-keyword">const</span> zip = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSZip</span>();<br>  <span class="hljs-keyword">const</span> cache = &#123;&#125;;<br>  <span class="hljs-keyword">const</span> promises = [];<br>  <span class="hljs-keyword">await</span> data.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> promise = <span class="hljs-title function_">getFile</span>(item.<span class="hljs-property">url</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 下载文件, 并存成ArrayBuffer对象</span><br>      zip.<span class="hljs-title function_">file</span>(item.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;.jpg&quot;</span>, data, &#123;<br>        <span class="hljs-attr">binary</span>: <span class="hljs-literal">true</span>,<br>      &#125;); <span class="hljs-comment">// 逐个添加文件</span><br>      cache[item.<span class="hljs-property">name</span>] = data;<br>    &#125;);<br>    promises.<span class="hljs-title function_">push</span>(promise);<br>  &#125;);<br>  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    zip<br>      .<span class="hljs-title function_">generateAsync</span>(&#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;blob&quot;</span>,<br>      &#125;)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">content</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// 生成二进制流</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(content);<br>        <span class="hljs-title function_">saveAs</span>(content, zipName + <span class="hljs-string">&quot;.zip&quot;</span>); <span class="hljs-comment">// 利用file-saver保存文件</span><br>      &#125;);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Vue-中为什么要有-nextTick"><a href="#Vue-中为什么要有-nextTick" class="headerlink" title="Vue 中为什么要有 nextTick"></a>Vue 中为什么要有 nextTick</h3><!-- more -->

<h4 id="Vue-针对渲染的优化"><a href="#Vue-针对渲染的优化" class="headerlink" title="Vue 针对渲染的优化"></a>Vue 针对渲染的优化</h4><p>Vue 会针对多次重复数据更新进行优化，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> num = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) &#123;<br>  num.<span class="hljs-property">value</span> = i;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>如果 num 是一个响应式变量，理论上每一次变化都会触发 Vue 的渲染。那么，以上代码会触发十万次渲染。<br>实际上，绝大部分情况下，用户需要的第一次 num：0 和最后一次 num：100000 的渲染。</p>
</blockquote>
<p>Vue 针对这种情况做了优化：</p>
<ol>
<li>在一次事件循环中，将不同的变量更新存储下来。而相同的变量更新会把最新的变化保留下来，而之前的变动数据会被丢弃掉。</li>
<li>等到同一事件循环中，所有的数据变动都完成时，再进行 Dom 的渲染更新</li>
</ol>
<p>这种优化会导致一个问题。如果我们在数据变化后，并且在 Vue 对 Dom 更新之前，想要基于最新的 Dom 去进行某些操作。那么，我们是找不到合适的操作时机的！<br>举个最典型的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">vif</span>=<span class="hljs-string">&quot;isShowParentNode&quot;</span>&gt;</span>parentNode<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> isShowParentNode = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);<br><br><span class="hljs-keyword">let</span> childrenNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>);<br>isShowParentNode.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;<br><span class="hljs-title class_">ParentNode</span>.<span class="hljs-title function_">append</span>(childrenNode);<br></code></pre></td></tr></table></figure>

<p>以上的代码，需要在 显示 ParentNode 之后，直接为其添加 childrenNode。<br>实际上，代码执行时，很有可能是拿不到 ParentNode 而报错。<br>此时，需要 NextTick</p>
<h4 id="NextTick-作用"><a href="#NextTick-作用" class="headerlink" title="NextTick 作用"></a>NextTick 作用</h4><p>利用 NextTick 可以达到目标</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 修改数据</span><br>vm.<span class="hljs-property">message</span> = <span class="hljs-string">&quot;修改后的值&quot;</span>;<br><span class="hljs-comment">// DOM 还没有更新</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(vm.<span class="hljs-property">$el</span>.<span class="hljs-property">textContent</span>); <span class="hljs-comment">// 原始的值</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">nextTick</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// DOM 更新了</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(vm.<span class="hljs-property">$el</span>.<span class="hljs-property">textContent</span>); <span class="hljs-comment">// 修改后的值</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<blockquote>
<p>在下次 DOM 更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的 DOM。</p>
</blockquote>
<h4 id="NextTick-原理"><a href="#NextTick-原理" class="headerlink" title="NextTick 原理"></a>NextTick 原理</h4><p>从代码上来看</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">vif</span>=<span class="hljs-string">&quot;isShowParentNode&quot;</span>&gt;</span>parentNode<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> isShowParentNode = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);<br><br><span class="hljs-keyword">let</span> childrenNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>);<br>isShowParentNode.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;<br><span class="hljs-title class_">NextTick</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">ParentNode</span>.<span class="hljs-title function_">append</span>(childrenNode);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>这里的 append 操作像是在 isShowParentNode 改变为 true 之后，就直接调用了。<br>但是实际上，NextTick 会把 出入的回调函数 放入到任务队列中进行等待，执行的是一个异步操作。</p>
<p>源码位置：/src/core/util/next-tick.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">nextTick</span>(<span class="hljs-params">cb?: <span class="hljs-built_in">Function</span>, ctx?: <span class="hljs-built_in">Object</span></span>) &#123;<br>  <span class="hljs-keyword">let</span> _resolve;<br>  <span class="hljs-comment">// cb 回调函数会经统一处理压入 callbacks 数组</span><br>  callbacks.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (cb) &#123;<br>      <span class="hljs-comment">// 给 cb 回调函数执行加上了 try-catch 错误处理</span><br>      <span class="hljs-keyword">try</span> &#123;<br>        cb.<span class="hljs-title function_">call</span>(ctx);<br>      &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>        <span class="hljs-title function_">handleError</span>(e, ctx, <span class="hljs-string">&quot;nextTick&quot;</span>);<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_resolve) &#123;<br>      <span class="hljs-title function_">_resolve</span>(ctx);<br>    &#125;<br>  &#125;);<br>  <span class="hljs-comment">// 执行异步延迟函数 timerFunc</span><br>  <span class="hljs-keyword">if</span> (!pending) &#123;<br>    pending = <span class="hljs-literal">true</span>;<br>    <span class="hljs-title function_">timerFunc</span>();<br>  &#125;<br>  <span class="hljs-comment">// 当 nextTick 没有传入函数参数的时候，返回一个 Promise 化的调用</span><br>  <span class="hljs-keyword">if</span> (!cb &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Promise</span> !== <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>      _resolve = resolve;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> isUsingMicroTask = <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Promise</span> !== <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp; <span class="hljs-title function_">isNative</span>(<span class="hljs-title class_">Promise</span>)) &#123;<br>  <span class="hljs-comment">//判断1：是否原生支持Promise</span><br>  <span class="hljs-keyword">const</span> p = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();<br>  timerFunc = <span class="hljs-function">() =&gt;</span> &#123;<br>    p.<span class="hljs-title function_">then</span>(flushCallbacks);<br>    <span class="hljs-keyword">if</span> (isIOS) <span class="hljs-built_in">setTimeout</span>(noop);<br>  &#125;;<br>  isUsingMicroTask = <span class="hljs-literal">true</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<br>  !isIE &amp;&amp;<br>  <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">MutationObserver</span> !== <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp;<br>  (<span class="hljs-title function_">isNative</span>(<span class="hljs-title class_">MutationObserver</span>) ||<br>    <span class="hljs-title class_">MutationObserver</span>.<span class="hljs-title function_">toString</span>() === <span class="hljs-string">&quot;[object MutationObserverConstructor]&quot;</span>)<br>) &#123;<br>  <span class="hljs-comment">//判断2：是否原生支持MutationObserver</span><br>  <span class="hljs-keyword">let</span> counter = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(flushCallbacks);<br>  <span class="hljs-keyword">const</span> textNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-title class_">String</span>(counter));<br>  observer.<span class="hljs-title function_">observe</span>(textNode, &#123;<br>    <span class="hljs-attr">characterData</span>: <span class="hljs-literal">true</span>,<br>  &#125;);<br>  timerFunc = <span class="hljs-function">() =&gt;</span> &#123;<br>    counter = (counter + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span>;<br>    textNode.<span class="hljs-property">data</span> = <span class="hljs-title class_">String</span>(counter);<br>  &#125;;<br>  isUsingMicroTask = <span class="hljs-literal">true</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> setImmediate !== <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp; <span class="hljs-title function_">isNative</span>(setImmediate)) &#123;<br>  <span class="hljs-comment">//判断3：是否原生支持setImmediate</span><br>  timerFunc = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setImmediate</span>(flushCallbacks);<br>  &#125;;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">//判断4：上面都不行，直接用setTimeout</span><br>  timerFunc = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(flushCallbacks, <span class="hljs-number">0</span>);<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">flushCallbacks</span>(<span class="hljs-params"></span>) &#123;<br>  pending = <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">const</span> copies = callbacks.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>);<br>  callbacks.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; copies.<span class="hljs-property">length</span>; i++) &#123;<br>    copies[i]();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>上面代码最主要的就是执行 timerFunc() ，而 timerFunc 就是 setTimeout(flushCallbacks, 0)，flushCallbacks 函数主要就是调用 NextTick 中传入的 Fn。</p>
<p>主要步骤如下：</p>
<ol>
<li>把回调函数放入 callbacks（即生成了一个由 callback 组成的数组） 等待执行，</li>
<li>（利用 setTimeout）将执行函数放到微任务或者宏任务中，</li>
<li>事件循环到了微任务或者宏任务，执行函数依次执行 callbacks 中的回调。</li>
</ol>
<h4 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h4><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNTU4NjUwMi00ZjJkM2Y3MWE5NGE0YTAwLnBuZw?x-oss-process=image/format,png" srcset="/img/loading.gif" lazyload alt="事件循环"></p>
<h3 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h3><blockquote>
<p>当你需要对普通 DOM 元素<strong>进行底层操作</strong>，这时候就会用到自定义指令</p>
</blockquote>
<ol>
<li><p>全局注册和局部注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 注册一个全局自定义指令 `v-focus`</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&#x27;focus&#x27;</span>, &#123;<br>  <span class="hljs-comment">// 当被绑定的元素插入到 DOM 中时……</span><br>  <span class="hljs-attr">inserted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) &#123;<br>    <span class="hljs-comment">// 聚焦元素</span><br>    el.<span class="hljs-title function_">focus</span>()<br>  &#125;<br>&#125;)<br><br><span class="hljs-comment">//注册一个局部组件指令</span><br><span class="hljs-attr">directive</span>:&#123;<br>  <span class="hljs-attr">focus</span>:&#123;<br>     <span class="hljs-comment">// 指令的定义</span><br>    <span class="hljs-attr">inserted</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">el</span>)&#123;<br>      el.<span class="hljs-title function_">focus</span>()<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>示例（改造后台系统的权限功能）</p>
<p>根据后台返回的权限数据来判断是否显示按钮</p>
<ul>
<li>HTML 结构</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;div id=<span class="hljs-string">&quot;app&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;mr_15&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">:loading</span>=<span class="hljs-string">&quot;isLoading&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addNewItem&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">v-has:merchantsMatchActivity_add</span></span></span><br><span class="hljs-tag"><span class="language-xml">            &gt;</span>新增&lt;/el-button</span><br><span class="language-xml">          &gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li>JS</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&quot;has&quot;</span>, &#123;<br>  <span class="hljs-attr">inserted</span>: <span class="hljs-function">(<span class="hljs-params">el, binding, vnode</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(vnode, el.<span class="hljs-property">parentNode</span>);<br>    <span class="hljs-keyword">let</span> path = vnode.<span class="hljs-property">context</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">path</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;/&quot;</span>)[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">checkHasPass</span>(path, binding.<span class="hljs-property">arg</span>)) &#123;<br>      el.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(el);<br>    &#125;<br>  &#125;,<br>&#125;);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkHasPass</span>(<span class="hljs-params">path, name</span>) &#123;<br>  <span class="hljs-keyword">let</span> operator = <span class="hljs-title function_">openFun</span>(path);<br>  <span class="hljs-keyword">let</span> pass = <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> operator) &#123;<br>    <span class="hljs-keyword">if</span> (key == name) &#123;<br>      pass = <span class="hljs-literal">true</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> pass;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs js">openFun是一个筛选数据的函数，如果有对应的权限字段，会返回一个对象<br><span class="hljs-keyword">let</span> op = &#123;&#125;;<br><span class="hljs-keyword">let</span> oneLevelArr = [];<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPer</span>(<span class="hljs-params">arr</span>) &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-comment">//只要商客 sys:10</span><br>    <span class="hljs-keyword">if</span> (arr[i].<span class="hljs-property">sys</span> == <span class="hljs-number">10</span>) &#123;<br>      <span class="hljs-keyword">if</span> (arr[i][<span class="hljs-string">&quot;children&quot;</span>] &amp;&amp; arr[i][<span class="hljs-string">&quot;children&quot;</span>].<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-title function_">getPer</span>(arr[i][<span class="hljs-string">&quot;children&quot;</span>]);<br>      &#125;<br>      oneLevelArr.<span class="hljs-title function_">push</span>(arr[i]);<br>    &#125;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">const</span> openFun = <span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name);<br>  op = &#123;&#125;;<br>  oneLevelArr = [];<br>  <span class="hljs-title function_">getPer</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;resources&quot;</span>)));<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; oneLevelArr.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">String</span>(oneLevelArr[i][<span class="hljs-string">&quot;icon&quot;</span>]) === name) &#123;<br>      op[oneLevelArr[i][<span class="hljs-string">&quot;resourceMark&quot;</span>]] =<br>        <span class="hljs-title class_">Number</span>(oneLevelArr[i][<span class="hljs-string">&quot;resourceType&quot;</span>]) === <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> op;<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> openFun;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">resources形如:通过循环router中的children.<span class="hljs-property">resourceMark</span>去判断是否有权限<br>[<br>  &#123;<br>    <span class="hljs-attr">router</span>: <span class="hljs-string">&#x27;merchantsMatchActivity&#x27;</span>,<br>    <span class="hljs-attr">resourceName</span>: <span class="hljs-string">&#x27;比赛激励管理&#x27;</span>,<br>    <span class="hljs-attr">sys</span>: <span class="hljs-number">10</span>,<br>    <span class="hljs-attr">children</span>: [<br>      <span class="hljs-attr">resourceMark</span>: <span class="hljs-string">&#x27;merchantsMatchActivity_add&#x27;</span>,<br>      <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;merchantsMatchActivity&#x27;</span>,<br>    ]<br>  &#125;<br>]<br></code></pre></td></tr></table></figure>

<p>Tips:</p>
<ol>
<li>el.parentNode.removeChild(el)方法需要配合 inserted 周期，配置 bind 周期会报错，父节点为 null</li>
<li>v-has:merchantsMatchActivity_add，冒号后面的字段会通过 arg 来拿到，并和 resource 去循环判断</li>
</ol>
</li>
<li><p>详细说明</p>
<ol>
<li><p>钩子函数</p>
<ul>
<li><strong>bind</strong>：只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。</li>
<li><strong>inserted</strong>：被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。</li>
<li><strong>update</strong>：所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前。指令的值可能发生了改变，也可能没有。但是你可以通过比较更新前后的值来忽略不必要的模板更新。</li>
<li><strong>componentUpdated</strong>：指令所在组件的 VNode 及其子 VNode 全部更新后调用。</li>
<li><strong>unbind</strong>：只调用一次，指令与元素解绑时调用。</li>
</ul>
</li>
<li><p>钩子函数参数</p>
<blockquote>
<p>除了 <code>el</code> 之外，其它参数都应该是只读的</p>
</blockquote>
<p>指令钩子函数会被传入以下参数：</p>
<ul>
<li><code>el</code>：指令所绑定的元素，可以用来直接操作 DOM 。</li>
<li><code>binding</code>：一个对象，包含以下属性：<ul>
<li><code>name</code>：指令名，不包括 v- 前缀。</li>
<li><code>value</code>：指令的绑定值，例如：v-my-directive=”1 + 1” 中，绑定值为 2。</li>
<li><code>oldValue</code>：指令绑定的前一个值，仅在 update 和 componentUpdated 钩子中可用。无论值是否改变都可用。</li>
<li><code>expression</code>：字符串形式的指令表达式。例如 v-my-directive=”1 + 1” 中，表达式为 “1 + 1”。</li>
<li><code>arg</code>：传给指令的参数，可选。例如 v-my-directive:foo 中，参数为 “foo”。</li>
<li><code>modifiers</code>：一个包含修饰符的对象。例如：v-my-directive.foo.bar 中，修饰符对象为 { foo: true, bar: true }。</li>
</ul>
</li>
<li><code>vnode</code>：Vue 编译生成的虚拟节点。</li>
<li><code>oldVnode</code>：上一个虚拟节点，仅在 update 和 componentUpdated 钩子中可用。</li>
</ul>
</li>
</ol>
<h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><h4 id="官网动态路由解释"><a href="#官网动态路由解释" class="headerlink" title="官网动态路由解释"></a>官网动态路由解释</h4><p>当多个 router-link 对应一个组件的时候，可以去使用动态路由，而不用设置多个组件一一对应</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = &#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;&lt;div&gt;User&lt;/div&gt;&quot;</span>,<br>&#125;;<br><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;<br>  <span class="hljs-attr">routes</span>: [<br>    <span class="hljs-comment">// 动态路径参数 以冒号开头</span><br>    &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/user/:id&quot;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">User</span> &#125;,<br>  ],<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>组件内部:可以通过$route.params 的形式拿到数据，从而可以渲染不同的数据出来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = &#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;&lt;div&gt;User &#123;&#123; $route.params.id &#125;&#125;&lt;/div&gt;&quot;</span>,<br>&#125;;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>当使用动态路由的时候，mounted 周期会失效，因为为了节省开销，VUE 在你使用动态路由功能的时候会复用之前已经生成的组件，导致根本就不会进入初始化周期。为此，添加一个新的周期：beforeRouteUpdate</p>
</blockquote>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = &#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;...&quot;</span>,<br>  <span class="hljs-title function_">beforeRouteUpdate</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) &#123;<br>    <span class="hljs-comment">// react to route changes...</span><br>    <span class="hljs-comment">// don&#x27;t forget to call next()</span><br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h4 id="实际上的动态路由应用"><a href="#实际上的动态路由应用" class="headerlink" title="实际上的动态路由应用"></a>实际上的动态路由应用</h4><p>实际上，我们谈论动态路由的时候，更多的是说获取后端的数据、动态添加路由、从而实现权限等渲染控制。类似动态生成菜单功能</p>
<ol>
<li><p>后端返回的数组数据</p>
<p>后端返回路由数据如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs js">routerList = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/other&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-string">&quot;Layout&quot;</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;noRedirect&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;otherPage&quot;</span>,<br>    <span class="hljs-attr">meta</span>: &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;测试&quot;</span>,<br>    &#125;,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;a&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-string">&quot;file/a&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;a&quot;</span>,<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;a页面&quot;</span>, <span class="hljs-attr">noCache</span>: <span class="hljs-string">&quot;true&quot;</span> &#125;,<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;b&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-string">&quot;file/b&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;b&quot;</span>,<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;b页面&quot;</span>, <span class="hljs-attr">noCache</span>: <span class="hljs-string">&quot;true&quot;</span> &#125;,<br>      &#125;,<br>    ],<br>  &#125;,<br>];<br></code></pre></td></tr></table></figure></li>
<li><p>前端静态路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-router&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Layout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/layout&quot;</span>;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Router</span>);<br><span class="hljs-comment">// 配置项目中没有涉及权限的公共路由</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> constantRoutes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/login&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;@/views/login&quot;</span>),<br>    <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/404&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&quot;@/views/404&quot;</span>),<br>    <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>];<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createRouter</span> = (<span class="hljs-params"></span>) =&gt;<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>(&#123;<br>    <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;history&quot;</span>,<br>    <span class="hljs-attr">scrollBehavior</span>: <span class="hljs-function">() =&gt;</span> (&#123; <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> &#125;),<br>    <span class="hljs-attr">routes</span>: constantRoutes,<br>  &#125;);<br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>();<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">resetRouter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> newRouter = <span class="hljs-title function_">createRouter</span>();<br>  router.<span class="hljs-property">matcher</span> = newRouter.<span class="hljs-property">matcher</span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;<br></code></pre></td></tr></table></figure>

<p>静态路由就直接按照正常的写法来处理</p>
</li>
<li><p>处理后台返回的路由格式</p>
<p>新建一个公共的<code>asyncRouter.js</code>文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 引入路由文件这种的公共路由</span><br><span class="hljs-keyword">import</span> &#123; constantRoutes &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../router&quot;</span>;<br><span class="hljs-comment">// Layout 组件是项目中的主页面，切换路由时，仅切换Layout中的组件</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Layout</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/layout&quot;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getAsyncRoutes</span>(<span class="hljs-params">routes</span>) &#123;<br>  <span class="hljs-keyword">const</span> res = [];<br>  <span class="hljs-comment">// 定义路由中需要的自定名</span><br>  <span class="hljs-keyword">const</span> keys = [<span class="hljs-string">&quot;path&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;children&quot;</span>, <span class="hljs-string">&quot;redirect&quot;</span>, <span class="hljs-string">&quot;meta&quot;</span>, <span class="hljs-string">&quot;hidden&quot;</span>];<br>  <span class="hljs-comment">// 遍历路由数组去重组可用的路由</span><br>  routes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> newItem = &#123;&#125;;<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">component</span>) &#123;<br>      <span class="hljs-comment">// 判断 item.component 是否等于 &#x27;Layout&#x27;,若是则直接替换成引入的 Layout 组件</span><br>      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">component</span> === <span class="hljs-string">&quot;Layout&quot;</span>) &#123;<br>        newItem.<span class="hljs-property">component</span> = <span class="hljs-title class_">Layout</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//  item.component 不等于 &#x27;Layout&#x27;,则说明它是组件路径地址，因此直接替换成路由引入的方法</span><br>        newItem.<span class="hljs-property">component</span> = <span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span><br>          <span class="hljs-built_in">require</span>([<span class="hljs-string">`@/views/<span class="hljs-subst">$&#123;item.component&#125;</span>`</span>], resolve);<br><br>        <span class="hljs-comment">// 此处用reqiure比较好，import引入变量会有各种莫名的错误</span><br>        <span class="hljs-comment">// newItem.component = (() =&gt; import(`@/views/$&#123;item.component&#125;`));</span><br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> item) &#123;<br>      <span class="hljs-keyword">if</span> (keys.<span class="hljs-title function_">includes</span>(key)) &#123;<br>        newItem[key] = item[key];<br>      &#125;<br>    &#125;<br>    <span class="hljs-comment">// 若遍历的当前路由存在子路由，需要对子路由进行递归遍历</span><br>    <span class="hljs-keyword">if</span> (newItem.<span class="hljs-property">children</span> &amp;&amp; newItem.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>) &#123;<br>      newItem.<span class="hljs-property">children</span> = <span class="hljs-title function_">getAsyncRoutes</span>(item.<span class="hljs-property">children</span>);<br>    &#125;<br>    res.<span class="hljs-title function_">push</span>(newItem);<br>  &#125;);<br>  <span class="hljs-comment">// 返回处理好且可用的路由数组</span><br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>其中，newItem 这个变量会被改造成类似如下结构：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>       <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/file&#x27;</span>,<br>       <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">&#x27;@/views/file&#x27;</span>),<br>       <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,<br>       <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;a&quot;</span>,<br>       <span class="hljs-attr">meta</span>: &#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;a页面&quot;</span>, <span class="hljs-string">&quot;noCache&quot;</span>: <span class="hljs-string">&quot;true&quot;</span> &#125;<br>   &#125;,<br></code></pre></td></tr></table></figure></li>
<li><p>添加到 router 上去</p>
<p>创建路由守卫：创建公共的 permission.js 文件，设置路由守卫</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//  进度条引入设置如上面第一种描述一样</span><br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./router&quot;</span>;<br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">NProgress</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;nprogress&quot;</span>; <span class="hljs-comment">// progress bar</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;nprogress/nprogress.css&quot;</span>; <span class="hljs-comment">// progress bar style</span><br><span class="hljs-keyword">import</span> &#123; getToken &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/auth&quot;</span>; <span class="hljs-comment">// get token from cookie</span><br><span class="hljs-keyword">import</span> &#123; getAsyncRoutes &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/asyncRouter&quot;</span>;<br><br><span class="hljs-keyword">const</span> whiteList = [<span class="hljs-string">&quot;/login&quot;</span>];<br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; &#123;<br>  <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">start</span>();<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>;<br>  <span class="hljs-comment">// 获取用户token，用来判断当前用户是否登录</span><br>  <span class="hljs-keyword">const</span> hasToken = <span class="hljs-title function_">getToken</span>();<br>  <span class="hljs-keyword">if</span> (hasToken) &#123;<br>    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">&quot;/login&quot;</span>) &#123;<br>      <span class="hljs-title function_">next</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span> &#125;);<br>      <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">//异步获取store中的路由</span><br>      <span class="hljs-keyword">let</span> route = <span class="hljs-keyword">await</span> store.<span class="hljs-property">state</span>.<span class="hljs-property">addRoutes</span>;<br>      <span class="hljs-keyword">const</span> hasRouters = route &amp;&amp; route.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;<br>      <span class="hljs-comment">//判断store中是否有路由，若有，进行下一步</span><br>      <span class="hljs-keyword">if</span> (hasRouters) &#123;<br>        <span class="hljs-title function_">next</span>();<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//store中没有路由，则需要获取获取异步路由，并进行格式化处理</span><br>        <span class="hljs-keyword">try</span> &#123;<br>          <span class="hljs-keyword">const</span> accessRoutes = <span class="hljs-title function_">getAsyncRoutes</span>(<span class="hljs-keyword">await</span> store.<span class="hljs-property">state</span>.<span class="hljs-property">addRoutes</span>);<br>          <span class="hljs-comment">// 动态添加格式化过的路由</span><br>          router.<span class="hljs-title function_">addRoutes</span>(accessRoutes);<br>          <span class="hljs-title function_">next</span>(&#123; ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> &#125;);<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>          <span class="hljs-comment">// Message.error(&#x27;出错了&#x27;)</span><br>          <span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">$&#123;to.path&#125;</span>`</span>);<br>          <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>();<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> (whiteList.<span class="hljs-title function_">indexOf</span>(to.<span class="hljs-property">path</span>) !== -<span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-title function_">next</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">$&#123;to.path&#125;</span>`</span>);<br>      <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>();<br>    &#125;<br>  &#125;<br>&#125;);<br><br>router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>();<br>&#125;);<br></code></pre></td></tr></table></figure></li>
<li><p>在 main.js 中引入 permission.js 文件</p>
</li>
<li><p>在 login 登录的时候将路由信息存储到 store 中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//  登录接口调用后，调用路由接口，后端返回相应用户的路由res.router，我们需要存储到store中，方便其他地方拿取</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&quot;addRoutes&quot;</span>, res.<span class="hljs-property">router</span>);<br></code></pre></td></tr></table></figure>

<p>到这里，整个动态路由就可以走通了，但是页面跳转、路由守卫处理是异步的，会存在动态路由添加后跳转的是空白页面，这是因为路由在执行 next()时，router 里面的数据还不存在，此时，你可以通过 window.location.reload()来刷新路由</p>
</li>
</ol>
<h3 id="混入（mixin）"><a href="#混入（mixin）" class="headerlink" title="混入（mixin）"></a>混入（mixin）</h3><h3 id="VueX-的基本介绍和使用"><a href="#VueX-的基本介绍和使用" class="headerlink" title="VueX 的基本介绍和使用"></a>VueX 的基本介绍和使用</h3><h4 id="VueX-的基本结构"><a href="#VueX-的基本结构" class="headerlink" title="VueX 的基本结构"></a>VueX 的基本结构</h4><ol>
<li><p>state</p>
<p>状态存储，类似 Data。</p>
</li>
<li><p>getter</p>
<p>可以将 getter 视为一个监听函数。可以避免重复引入一些方法，例如：每次都要对数据进行重复筛选 filter 功能，那么就要引入相同的公共函数。那么就可以用 getter 去直接筛选，并通过类似如下：</p>
<p>页面中使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">v-<span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;item in filterModuleList(searchText)&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">computed</span>: &#123;<br>  ...<span class="hljs-title function_">mapGetters</span>(&#123;<br>      <span class="hljs-attr">filterModuleList</span>: <span class="hljs-string">&quot;mailHomePageConfig/filterModuleList&quot;</span><br>    &#125;),<br>&#125;<br></code></pre></td></tr></table></figure>

<p>VueX 中定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> getters = &#123;<br>  <span class="hljs-attr">filterModuleList</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">searchText</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (searchText) &#123;<br>      <span class="hljs-keyword">return</span> state.<span class="hljs-property">moduleList</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item);<br>        <span class="hljs-keyword">return</span> item[<span class="hljs-string">&quot;name&quot;</span>].<span class="hljs-title function_">indexOf</span>(searchText) &gt; -<span class="hljs-number">1</span>;<br>      &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> state.<span class="hljs-property">moduleList</span>;<br>    &#125;<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure></li>
<li><p>action</p>
<p>action 实际上是一个专门用于 提供复杂业务逻辑及异步操作（如 axios 的异步请求），然后通过 commit 或者 dispatch 来触发 mutation 从而更新 state 中的数据。</p>
</li>
<li><p>mutation</p>
<p>mutation 用于更新 state 数据，并且只用于更新数据。</p>
</li>
</ol>
<h4 id="VueX-的要点"><a href="#VueX-的要点" class="headerlink" title="VueX 的要点"></a>VueX 的要点</h4><ol>
<li><p>…mapState,…mapGetter</p>
<p>这个是为了节省重复引入 VueX 内的 state 的字段而设计的。</p>
<p>ES6 的结构方法，函数使用如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">computed</span>: &#123;<br>   ...<span class="hljs-title function_">mapState</span>(&#123;<br>     <span class="hljs-comment">// 传字符串参数 &#x27;moduleList&#x27; ，可以省略后续的return</span><br>     moduleList,<br>     <span class="hljs-comment">// 传字符串参数 &#x27;count&#x27; 等同于 `state =&gt; state.count`，这个是别名countAlias</span><br>     <span class="hljs-attr">countAlias</span>: <span class="hljs-string">&#x27;count&#x27;</span>,<br>     <span class="hljs-attr">operator</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">mailHomePageConfig</span>.<span class="hljs-property">operator</span>,<br>     <span class="hljs-comment">// 为了能够使用 `this` 获取局部状态，必须使用常规函数</span><br>     countPlusLocalState (state) &#123;<br>     <span class="hljs-keyword">return</span> state.<span class="hljs-property">count</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">localCount</span><br>   &#125;<br>   &#125;),<br>   ...<span class="hljs-title function_">mapGetters</span>(&#123;<br>     <span class="hljs-attr">filterModuleList</span>: <span class="hljs-string">&quot;mailHomePageConfig/filterModuleList&quot;</span><br>   &#125;),<br>   <span class="hljs-attr">curCity</span>: &#123;<br>     <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">state</span>.<span class="hljs-property">mailHomePageConfig</span>.<span class="hljs-property">curCity</span>;<br>     &#125;,<br>     <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) &#123;<br>       <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;mailHomePageConfig/updateCurCity&quot;</span>, value);<br>     &#125;<br>   &#125;<br> &#125;,<br></code></pre></td></tr></table></figure></li>
<li><p>dispatch 和 commit</p>
<p>commit 和 dispatch 的区别在于 commit 是提交 mutatious 的同步操作，dispatch 是分发 actions 的异步操作然后再手动调用 commit 更新</p>
<p>dispatch：含有异步操作，例如向后台提交数据，写法： this.$store.dispatch(‘action 方法名’,值)</p>
<p>dispatch 实际上是调用一个异步方法，然后再异步方法中再调用 commit 去同步更新。</p>
<p>commit：同步操作，写法：this.$store.commit(‘mutations 方法名’,值)</p>
</li>
</ol>
<h3 id="scss-的换肤功能"><a href="#scss-的换肤功能" class="headerlink" title="scss 的换肤功能"></a>scss 的换肤功能</h3><h4 id="scss-配置文件"><a href="#scss-配置文件" class="headerlink" title="scss 配置文件"></a>scss 配置文件</h4><p>变量的定义文件_handle.scss</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs js">@<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./_themes.scss&#x27;</span>;<br><br><span class="hljs-comment">//遍历主题map</span><br>@mixin themeify &#123;<br>  @each $theme-name, $theme-map <span class="hljs-keyword">in</span> $themes &#123;<br>    <span class="hljs-comment">//!global 把局部变量强升为全局变量</span><br>    $theme-<span class="hljs-attr">map</span>: $theme-map !<span class="hljs-variable language_">global</span>;<br>    <span class="hljs-comment">//判断html的data-theme的属性值  #&#123;&#125;是sass的插值表达式</span><br>    <span class="hljs-comment">//&amp; sass嵌套里的父容器标识   @content是混合器插槽，像vue的slot</span><br>    [data-theme=<span class="hljs-string">&#x27;#&#123;$theme-name&#125;&#x27;</span>] &amp; &#123;<br>      @content;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//声明一个根据Key获取颜色的function</span><br>@<span class="hljs-keyword">function</span> <span class="hljs-title function_">themed</span>(<span class="hljs-params">$key</span>) &#123;<br>  @<span class="hljs-keyword">return</span> map-<span class="hljs-title function_">get</span>($theme-map, $key);<br>&#125;<br><br><span class="hljs-comment">//获取背景颜色</span><br>@mixin <span class="hljs-title function_">background_color</span>(<span class="hljs-params">$color</span>) &#123;<br>  @include themeify &#123;<br>    background-<span class="hljs-attr">color</span>: <span class="hljs-title function_">themed</span>($color) !important;<br>  &#125;<br>&#125;<br><br>@mixin <span class="hljs-title function_">background</span>(<span class="hljs-params">$color</span>) &#123;<br>  @include themeify &#123;<br>    <span class="hljs-attr">background</span>: <span class="hljs-title function_">themed</span>($color) !important;<br>  &#125;<br>&#125;<br><span class="hljs-comment">// 阴影颜色</span><br><br>@mixin <span class="hljs-title function_">box_shadow</span>(<span class="hljs-params">$color</span>) &#123;<br>  @include themeify &#123;<br>    box-<span class="hljs-attr">shadow</span>: <span class="hljs-title function_">themed</span>($color) !important;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//获取字体颜色</span><br>@mixin <span class="hljs-title function_">font_color</span>(<span class="hljs-params">$color</span>) &#123;<br>  @include themeify &#123;<br>    <span class="hljs-attr">color</span>: <span class="hljs-title function_">themed</span>($color) !important;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//获取边框颜色</span><br>@mixin <span class="hljs-title function_">border_color</span>(<span class="hljs-params">$color</span>) &#123;<br>  @include themeify &#123;<br>    border-<span class="hljs-attr">color</span>: <span class="hljs-title function_">themed</span>($color) !important;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>主题色配置文件_themes</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//_themes.scss</span><br><span class="hljs-comment">//当HTML的data-theme为dark时，样式引用dark</span><br><span class="hljs-comment">//data-theme为其他值时，就采用组件库的默认样式</span><br><span class="hljs-comment">//注意一点是，每套配色方案里的key可以自定义但必须一致，不然就会混乱</span><br><br><span class="hljs-attr">$themes</span>: (<br>    <span class="hljs-attr">green</span>: (<br>      <span class="hljs-comment">//字体</span><br>      <span class="hljs-attr">font_color1</span>: #0BB3AC,<br>      <span class="hljs-attr">font_color2</span>: #4CCBC8,<br><br>      <span class="hljs-comment">//背景</span><br>      <span class="hljs-attr">background_color1</span>: #0BB3AC,<br>      <span class="hljs-attr">background_color2</span>: <span class="hljs-title function_">rgba</span>(<span class="hljs-number">11</span>, <span class="hljs-number">179</span>, <span class="hljs-number">172</span>, <span class="hljs-number">0.2</span>),<br>      <span class="hljs-attr">box_shadow3</span>: 0px 2px 6px 0px <span class="hljs-title function_">rgba</span>(<span class="hljs-number">11</span>, <span class="hljs-number">179</span>, <span class="hljs-number">172</span>, <span class="hljs-number">0.2</span>),<br>      <span class="hljs-attr">background1</span>: linear-<span class="hljs-title function_">gradient</span>(90deg,<span class="hljs-title function_">rgba</span>(<span class="hljs-number">76</span>,<span class="hljs-number">203</span>,<span class="hljs-number">200</span>,<span class="hljs-number">1</span>),<span class="hljs-title function_">rgba</span>(<span class="hljs-number">11</span>,<span class="hljs-number">179</span>,<span class="hljs-number">172</span>,<span class="hljs-number">1</span>)),<br>      <span class="hljs-comment">//边框</span><br>      <span class="hljs-attr">border_color1</span>: #0BB3AC,<br>    ),<br>    <span class="hljs-comment">// 橘色主题</span><br>    <span class="hljs-attr">orange</span>: (<br>        <span class="hljs-comment">//字体</span><br>        <span class="hljs-attr">font_color1</span>: #<span class="hljs-title class_">FF6A</span>47,<br>        <span class="hljs-attr">font_color2</span>: <span class="hljs-title function_">rgb</span>(<span class="hljs-number">248</span>, <span class="hljs-number">138</span>, <span class="hljs-number">114</span>),<br><br>        <span class="hljs-comment">//背景</span><br>        <span class="hljs-attr">background_color1</span>: #<span class="hljs-title class_">FF6A</span>47,<br>        <span class="hljs-attr">background_color2</span>: <span class="hljs-title function_">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">106</span>,<span class="hljs-number">71</span>,<span class="hljs-number">0.2</span>),<br>        <span class="hljs-attr">box_shadow3</span>: 0px 2px 6px 0px <span class="hljs-title function_">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">106</span>,<span class="hljs-number">71</span>,<span class="hljs-number">0.2</span>),<br>        <span class="hljs-attr">background1</span>: linear-<span class="hljs-title function_">gradient</span>(90deg,<span class="hljs-title function_">rgba</span>(<span class="hljs-number">245</span>, <span class="hljs-number">149</span>, <span class="hljs-number">128</span>, <span class="hljs-number">1</span>),<span class="hljs-title function_">rgba</span>(<span class="hljs-number">245</span>, <span class="hljs-number">128</span>, <span class="hljs-number">101</span>, <span class="hljs-number">1</span>)),<br><br>        <span class="hljs-comment">//边框</span><br>        <span class="hljs-attr">border_color1</span>: #<span class="hljs-title class_">FF6A</span>47,<br><br>    ),<br><br>    <span class="hljs-attr">blue</span>: (<br>      <span class="hljs-comment">//字体</span><br>      <span class="hljs-attr">font_color1</span>: #2E9CFF,<br>      <span class="hljs-attr">font_color2</span>: <span class="hljs-title function_">rgb</span>(<span class="hljs-number">101</span>, <span class="hljs-number">175</span>, <span class="hljs-number">240</span>),<br><br>      <span class="hljs-comment">//背景</span><br>      <span class="hljs-attr">background_color1</span>: #2E9CFF,<br>      <span class="hljs-attr">background_color2</span>: <span class="hljs-title function_">rgba</span>(<span class="hljs-number">46</span>,<span class="hljs-number">156</span>,<span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>),<br>      <span class="hljs-attr">box_shadow3</span>: 0px 2px 6px 0px <span class="hljs-title function_">rgba</span>(<span class="hljs-number">46</span>,<span class="hljs-number">156</span>,<span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>),<br>      <span class="hljs-attr">background1</span>: linear-<span class="hljs-title function_">gradient</span>(90deg,<span class="hljs-title function_">rgba</span>(<span class="hljs-number">99</span>, <span class="hljs-number">172</span>, <span class="hljs-number">236</span>, <span class="hljs-number">1</span>),<span class="hljs-title function_">rgba</span>(<span class="hljs-number">46</span>,<span class="hljs-number">156</span>,<span class="hljs-number">255</span>,<span class="hljs-number">1</span>)),<br>      <span class="hljs-comment">//边框</span><br>      <span class="hljs-attr">border_color1</span>: #2E9CFF,<br><br>    ),<br><br>    <span class="hljs-attr">yellow</span>: (<br>      <span class="hljs-comment">//字体</span><br>      <span class="hljs-attr">font_color1</span>: #<span class="hljs-title class_">FFAF2E</span>,<br>      <span class="hljs-attr">font_color2</span>: <span class="hljs-title function_">rgb</span>(<span class="hljs-number">240</span>, <span class="hljs-number">197</span>, <span class="hljs-number">128</span>),<br><br>      <span class="hljs-comment">//背景</span><br>      <span class="hljs-attr">background_color1</span>: #<span class="hljs-title class_">FFAF2E</span>,<br>      <span class="hljs-attr">background_color2</span>: <span class="hljs-title function_">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">175</span>,<span class="hljs-number">46</span>, <span class="hljs-number">0.2</span>),<br>      <span class="hljs-attr">box_shadow3</span>: 0px 2px 6px 0px <span class="hljs-title function_">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">175</span>,<span class="hljs-number">46</span>, <span class="hljs-number">0.2</span>),<br>      <span class="hljs-attr">background1</span>: linear-<span class="hljs-title function_">gradient</span>(90deg,<span class="hljs-title function_">rgba</span>(<span class="hljs-number">240</span>, <span class="hljs-number">186</span>, <span class="hljs-number">99</span>, <span class="hljs-number">1</span>),<span class="hljs-title function_">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">175</span>,<span class="hljs-number">46</span>,<span class="hljs-number">1</span>)),<br>      <span class="hljs-comment">//边框</span><br>      <span class="hljs-attr">border_color1</span>: #<span class="hljs-title class_">FFAF2E</span>,<br><br>    ),<br><br>    <span class="hljs-attr">red</span>: (<br>      <span class="hljs-comment">//字体</span><br>      <span class="hljs-attr">font_color1</span>: #<span class="hljs-variable constant_">F52231</span>,<br>      <span class="hljs-attr">font_color2</span>: <span class="hljs-title function_">rgb</span>(<span class="hljs-number">238</span>, <span class="hljs-number">79</span>, <span class="hljs-number">90</span>),<br><br>      <span class="hljs-comment">//背景</span><br>      <span class="hljs-attr">background_color1</span>: #<span class="hljs-variable constant_">F52231</span>,<br>      <span class="hljs-attr">background_color2</span>: <span class="hljs-title function_">rgba</span>(<span class="hljs-number">245</span>,<span class="hljs-number">34</span>,<span class="hljs-number">49</span>, <span class="hljs-number">0.2</span>),<br>      <span class="hljs-attr">box_shadow3</span>: 0px 2px 6px 0px <span class="hljs-title function_">rgba</span>(<span class="hljs-number">245</span>,<span class="hljs-number">34</span>,<span class="hljs-number">49</span>, <span class="hljs-number">0.2</span>),<br>      <span class="hljs-attr">background1</span>: linear-<span class="hljs-title function_">gradient</span>(90deg,<span class="hljs-title function_">rgba</span>(<span class="hljs-number">247</span>, <span class="hljs-number">198</span>, <span class="hljs-number">121</span>, <span class="hljs-number">1</span>),<span class="hljs-title function_">rgba</span>(<span class="hljs-number">245</span>,<span class="hljs-number">34</span>,<span class="hljs-number">49</span>,<span class="hljs-number">1</span>)),<br>      <span class="hljs-comment">//边框</span><br>      <span class="hljs-attr">border_color1</span>: #<span class="hljs-variable constant_">F52231</span>,<br>    )<br>);<br></code></pre></td></tr></table></figure>

<h4 id="引入使用功能"><a href="#引入使用功能" class="headerlink" title="引入使用功能"></a>引入使用功能</h4><p>在 app.vue 中通过设置 data 数据来判断当前主题色，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-property">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>, <span class="hljs-string">&quot;orange&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>文件中引用变量设置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;style lang=<span class="hljs-string">&quot;scss&quot;</span> scoped&gt;<br>  @<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;@/common/_handle.scss&#x27;</span>;<br>.<span class="hljs-property">btn_reject</span> &#123;<br>  <span class="hljs-comment">//   background: $blueLinear-gradient;</span><br>  @include <span class="hljs-title function_">background_color</span>(<span class="hljs-string">&#x27;background_color1&#x27;</span>);<br>  <span class="hljs-attr">color</span>: #ffffff;<br>  box-<span class="hljs-attr">shadow</span>: <span class="hljs-number">0</span> 5rpx 10rpx <span class="hljs-number">0</span> <span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">29</span>, <span class="hljs-number">138</span>, <span class="hljs-number">0.3</span>);<br>  @include <span class="hljs-title function_">box_shadow</span>(<span class="hljs-string">&#x27;box_shadow3&#x27;</span>);<br>  <span class="hljs-attr">border</span>: 2px solid #486cdc;<br>  @include <span class="hljs-title function_">borde_color</span>(<span class="hljs-string">&#x27;font_color1&#x27;</span>);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>@include background_color 和@include box_shadow 这些变量都是通过 handle 文件来定义的。</p>
<p>注意：border 这类需要多个维度来判断的 class，只需要改变其中的颜色部分。会自动覆盖对应之前定义的 border 中的颜色#486cdc</p>
<h3 id="mini-Vue-极简说明"><a href="#mini-Vue-极简说明" class="headerlink" title="mini-Vue 极简说明"></a>mini-Vue 极简说明</h3><p>省去一切额外开销，几句话讲出 mini-Vue 大概逻辑</p>
<!-- more -->

<h4 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; reactive, effect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../vue3.js&quot;</span>;<br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment">  场景 1</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>(&#123; <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> &#125;);<br><br><span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">patch</span>();<br>&#125;);<br><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  obj.<span class="hljs-property">x</span> = <span class="hljs-number">2</span>;<br>&#125;, <span class="hljs-number">1000</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerText</span> = obj.<span class="hljs-property">x</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>当 1S 后执行 obj.x = 2 时，会触发 patch。就说明 obj 是一个响应式对象，改变他的值会触发 effect 内的函数</p>
<h4 id="收集和触发依赖（reactive）"><a href="#收集和触发依赖（reactive）" class="headerlink" title="收集和触发依赖（reactive）"></a>收集和触发依赖（reactive）</h4><p>reactive 是一个函数，接受复杂对象为参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, &#123;<br>  <span class="hljs-title function_">get</span>(<span class="hljs-params">target,key,receiver</span>)&#123;<br>    <span class="hljs-keyword">const</span> res = <span class="hljs-title class_">Reflect</span> <span class="hljs-title function_">get</span>(target,key,receiver)<br>    <span class="hljs-title function_">track</span>()<br>    <span class="hljs-keyword">return</span> res<br>  &#125;,<br>  <span class="hljs-title function_">set</span>(<span class="hljs-params">target,key,receiver</span>)&#123;<br>    <span class="hljs-keyword">const</span> res = <span class="hljs-title class_">Reflect</span> <span class="hljs-title function_">get</span>(target,key,receiver)<br>    <span class="hljs-title function_">trigger</span>()<br>    <span class="hljs-keyword">return</span> res<br>  &#125;,<br>&#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>每当 obj.x 执行时，会触发 get，当 obj.x =2 赋值时，会触发 trigger</p>
<h5 id="track-函数是收集依赖"><a href="#track-函数是收集依赖" class="headerlink" title="track 函数是收集依赖"></a>track 函数是收集依赖</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) &#123;<br>  <span class="hljs-keyword">let</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);<br>  <span class="hljs-keyword">if</span> (!depsMap) &#123;<br>    depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();<br>    targetMap.<span class="hljs-title function_">set</span>(target, depsMap);<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);<br>  <span class="hljs-keyword">if</span> (!dep) &#123;<br>    dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();<br>    depsMap.<span class="hljs-title function_">set</span>(key, dep);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (dep.<span class="hljs-title function_">has</span>(activeEffect)) <span class="hljs-keyword">return</span>;<br><br>  dep.<span class="hljs-title function_">add</span>(activeEffect);<br>  activeEffect.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>track 函数就是收集依赖，既然拿到了依赖，就必须要找个对象去存储起来。<br>targetMap 就是用来存储依赖的对象，是一个 weekMap，形如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123; <span class="hljs-comment">// 这是一个WeakMap</span><br>  [target]: &#123; <span class="hljs-comment">// key是reactiveObject, value是一个Map</span><br>    [key]: [] <span class="hljs-comment">// key是reactiveObject的键值, value是一个Set</span><br>  &#125;<br>&#125;<br><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>(&#123; <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> &#125;);<br></code></pre></td></tr></table></figure>

<p>以上面的 obj 为例，target 是{ x: 1 }，key 是 x。</p>
<blockquote>
<p><strong>那么里面 x 对应的[]是什么呢？留到后面的 Effect 函数</strong></p>
</blockquote>
<h5 id="trigger-函数是触发依赖"><a href="#trigger-函数是触发依赖" class="headerlink" title="trigger 函数是触发依赖"></a>trigger 函数是触发依赖</h5><h3 id="cancletoken-的使用（取消上一次的请求）"><a href="#cancletoken-的使用（取消上一次的请求）" class="headerlink" title="cancletoken 的使用（取消上一次的请求）"></a>cancletoken 的使用（取消上一次的请求）</h3><p>当上一次请求没有完成时，再次发起请求，需要首先结束上一次请求。然后再发起新的请求</p>
<p>axios 有提供 cancletoken 的方案，记录如下</p>
<!-- more -->

<h4 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h4><p>现在又个 tabs 切换，第一个 tab 请求数据较大，需要 10 秒获取数据，第二个 tab 需求请求 5 秒，第三个需要请求 1 秒。</p>
<p>当点击第一个时，等待 1 秒后，再切换第二个 tab，再等待 1 秒，切换第三个 tab。</p>
<blockquote>
<p>数据的显示会首先显示第三次请求的数据，然后显示第二次请求的数据，最后显示到页面上渲染出来的时第一次请求到的数据。这个是不正确的，需要显示第三次请求的数据。</p>
</blockquote>
<p><img src="https://limengtupian.oss-cn-beijing.aliyuncs.com/canceltoken%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/cancletoken.png" srcset="/img/loading.gif" lazyload alt="需求图片"></p>
<h4 id="解决代码"><a href="#解决代码" class="headerlink" title="解决代码"></a>解决代码</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-comment">// process.env.NODE_ENV === &#x27;development&#x27; 来判断是否开发环境</span><br>  <span class="hljs-attr">baseURL</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;development&#x27;</span> ? <span class="hljs-string">&#x27;/&#x27;</span> : host.<span class="hljs-property">host</span>,<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">60000000</span><br>&#125;);<br><span class="hljs-keyword">let</span> cancel = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">let</span> url = <span class="hljs-literal">null</span>;<br>service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> &#123;<br>  <span class="hljs-comment">// 在 cardCertificateReceive 页面中，存在tab切换发起多次请求需求，需要在本次请求时取消上次请求，故添加取消请求拦截</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> (cancel) == <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (url == config.<span class="hljs-property">url</span>)<br>      <span class="hljs-title function_">cancel</span>(<span class="hljs-string">&#x27;强制取消了请求&#x27;</span>)<br>  &#125;<br>  url = config.<span class="hljs-property">url</span>;<br>  <span class="hljs-comment">// 将cancel变成function</span><br>  config[<span class="hljs-string">&#x27;cancelToken&#x27;</span>] = <span class="hljs-keyword">new</span> axios.<span class="hljs-title class_">CancelToken</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c, <span class="hljs-string">&#x27;c&#x27;</span>)<br>    cancel = c<br>  &#125;)<br>  <span class="hljs-keyword">return</span> config;<br>&#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>();<br>&#125;);<br>service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">data</span>.<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) &#123;<br>      <span class="hljs-comment">//请求成功后，将cancel置为null。以通过下次请求。</span><br>      cancel = <span class="hljs-literal">null</span>;<br>      url = <span class="hljs-literal">null</span>;<br>      <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;<br>    &#125;<br>&#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>&#125;);<br></code></pre></td></tr></table></figure>


<h2 id="vue-项目上线优化记录"><a href="#vue-项目上线优化记录" class="headerlink" title="vue 项目上线优化记录"></a>vue 项目上线优化记录</h2><p>项目上线，没有进行备案，所以需要架设于境外服务器，所有访问速度较慢，现在记录所作优化步骤：</p>
<ol>
<li>引用线上地址</li>
<li>将静态资源放置于网络存储</li>
<li>精灵图减少请求</li>
<li>服务器开通 gzip</li>
<li>路由懒加载</li>
</ol>
<!-- more -->

<h3 id="引用线上地址"><a href="#引用线上地址" class="headerlink" title="引用线上地址"></a>引用线上地址</h3><p>使用的是 bootstrap，之前是通过下载到本地，然后引用，当 build 的时候，会将其一并打包，所以导致 js 文件过大，所以直接将引用地址改为网络请求，这样，打包后的文件会减小很多。</p>
<blockquote>
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
</blockquote>
<h3 id="将静态资源放置于网络存储"><a href="#将静态资源放置于网络存储" class="headerlink" title="将静态资源放置于网络存储"></a>将静态资源放置于网络存储</h3><p>网站的大部分图片都不会改动，所以将其上传到 oss 网络存储然后直接引用网络地址，这里采用的是北京的 oss，这样从服务器请求的时候是从北京地区请求的图片，相对速度会快一些。</p>
<blockquote>
<p>background-image: url(“<a target="_blank" rel="noopener" href="https://limengtupian.oss-cn-beijing.aliyuncs.com/%E9%A6%96%E9%A1%B5%E7%B2%BE%E7%81%B5%E5%9B%BE/img.png&quot;">https://limengtupian.oss-cn-beijing.aliyuncs.com/%E9%A6%96%E9%A1%B5%E7%B2%BE%E7%81%B5%E5%9B%BE/img.png&quot;</a>);</p>
</blockquote>
<h3 id="精灵图减少请求"><a href="#精灵图减少请求" class="headerlink" title="精灵图减少请求"></a>精灵图减少请求</h3><p>每一张图片都会发起一次请求，所以对于一些常用的小图标，我们一般都会将其做成一张图，然后通过定位的方式，显示出其中的一部分，这样的图片就是精灵图。</p>
<h3 id="服务器开通-gzip"><a href="#服务器开通-gzip" class="headerlink" title="服务器开通 gzip"></a>服务器开通 gzip</h3><p>gzip 可以直接再服务端的时候，就对要传输的数据先进行一次压缩，减少传输数据的体积，这个概念跟下载游戏文件的时候一般下载下来的都是压缩包是类似的，然后再客户端的浏览器上，会进行解压处理，这样就大大减少了文件体积，减少的传输速度。</p>
<p>由于是采用的 vue-cli 3.0 ，查阅网上资料发现，通过 3.0 去构建的项目，是默认的开启 gzip 的，那么只需要再服务器上的配置文件修改。</p>
<p>采用的是 nginx，所以找到对应的 conf 文件(/usr/local/nginx/conf)，修改如下：</p>
<blockquote>
<p>http {</p>
<p>gzip on;</p>
<p>gzip_min_length 1k;</p>
<p>gzip_buffers 4 16k;</p>
<p>#gzip_http_version 1.0;</p>
<p>gzip_comp_level 6;</p>
<p>gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</p>
<p>gzip_vary off;</p>
<p>gzip_disable “MSIE [1-6].“;</p>
<p>}</p>
</blockquote>
<p>再次请求，可以通过谷歌浏览器-F12-network-点击任意文件-header 内的 request header 中，可以看到：</p>
<p><strong>Accept-Encoding</strong>：gzip</p>
<p>已经是通过了 zip 压缩的文件了，体积明显缩小</p>
<h3 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h3><p>单页面应用是会再首页加载的时候将所有的页面直接加载完成，所以会出现首页加载较长的情况，这样就需要采用懒加载，当页面被点击的时候再加载。那么，配置如下：</p>
<p>在 router 中配置如下：</p>
<blockquote>
<p>export default {</p>
<p>path: ‘/home’,</p>
<p>component: () =&gt; import(‘@/views/Home.vue’)</p>
<p>}</p>
</blockquote>
<p>将其 component 修改成了() =&gt; import(‘@/views/Home.vue’)。</p>
<p>但是现在<strong>路由懒加载不生效</strong>，因为 cli 3.0 是直接默认会把所有通过 import()按需加载的 javascript 文件加上 prefetch 。</p>
<p><strong>关闭 prefetch:</strong> (官网示例)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">// vue.config.js module.exports = &#123; chainWebpack: config =&gt; &#123; // 移除 prefetch<br>插件 config.plugins.delete(&#x27;prefetch&#x27;) // 或者 // 修改它的选项：<br>config.plugin(&#x27;prefetch&#x27;).tap(options =&gt; &#123; options[0].fileBlacklist =<br>options[0].fileBlacklist || []<br>options[0].fileBlacklist.push(/myasyncRoute(.)+?\.js$/) return options &#125;) &#125;<br></code></pre></td></tr></table></figure>

<p>prefetch 链接会消耗宽带，如果是在移动端，而且存在大量的 chunk，那么可以关掉 prefetch 链接，手动选择要提前获取的代码区块。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">//手动选定要提前获取的代码 import(webpackPrefetch: true,<br>&#x27;./someAsyncComponent.vue&#x27;)<br></code></pre></td></tr></table></figure>

<h2 id="vue-cli-上线-代理接口报-404-修改-conf"><a href="#vue-cli-上线-代理接口报-404-修改-conf" class="headerlink" title="vue-cli 上线 代理接口报 404 修改 conf"></a>vue-cli 上线 代理接口报 404 修改 conf</h2><p>前言： 项目使用 vue-cli 直接生成项目，然后使用 proxyTable 接口代理后， 在本地调用后台接口，一切正常，但是后期打包上线时，发现页面接口报 404，后找到解决办法为：</p>
<p>找到 nginx 的 conf 文件，打开后，修改里面的配置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">server &#123; listen 80;//监听80端口 server_name localhost; location / &#123; root html;<br>index index.html index.htm; try_files $uri $uri/ /index.html;<br>//vue单页面应用，不能刷新，所有会设置这个，避免404 &#125; location /v2/ &#123;<br>proxy_set_header X-Real-IP $remote_addr; proxy_pass http://douban.uieee.com; &#125;<br>error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;<br></code></pre></td></tr></table></figure>

<p>里面主要添加的配置为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">location /v2/ &#123; proxy_set_header X-Real-IP $remote_addr; proxy_pass<br>http://douban.uieee.com; &#125;<br></code></pre></td></tr></table></figure>

<p>这个/v2/监听，实际上就是我 api 调用的名字，这个可以在你的 vue.config.js 里可以去设置：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">module.exports = &#123; //axios域代理，解决axios跨域问题 devServer: &#123; proxy: &#123; &#x27;/v2&#x27;:<br>&#123; target: &#x27;https://douban.uieee.com&#x27;, changeOrigin: true, ws: true, &#125; &#125; &#125; &#125;<br></code></pre></td></tr></table></figure>

<p>我请求的 api 格式如下：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://douban.uieee.com/v2/movie/top250?start=0&amp;count=12">https://douban.uieee.com/v2/movie/top250?start=0&amp;count=12</a></p>
</blockquote>
<p>提供的 api 文档里面可以看到，所有的 api 都带有一个相同的字符/v2/。</p>
<p>所以以这个字符为关键字来修改代理。</p>
<meta name="referrer" content="no-referrer"/>

<h2 id="初始化设置和环境搭建（neginx-centOS，vue-的环境搭建）-GitHub-相关"><a href="#初始化设置和环境搭建（neginx-centOS，vue-的环境搭建）-GitHub-相关" class="headerlink" title="初始化设置和环境搭建（neginx,centOS，vue 的环境搭建）/GitHub 相关"></a>初始化设置和环境搭建（neginx,centOS，vue 的环境搭建）/GitHub 相关</h2><h3 id="安装-node-js"><a href="#安装-node-js" class="headerlink" title="安装 node.js"></a>安装 node.js</h3><p>一般来讲, 可以用以下三种方式安装 Node.js：</p>
<ul>
<li>通过安装包安装(Windows 和 Mac 用户推荐)</li>
<li>通过源码编译安装(Linux 用户推荐)</li>
<li>在 Linux 下可以通过 yum|apt-get 安装</li>
</ul>
<ol>
<li><p>通过安装包安装：</p>
</li>
<li><p>源码编译安装：</p>
<!-- more -->

<p>Linux 用户：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">curl -O https://nodejs.org/dist/v6.<span class="hljs-number">10.3</span>/<span class="hljs-keyword">node</span><span class="hljs-title">-v6</span>.<span class="hljs-number">10.3</span>.tar.gz<br>tar -xzvf <span class="hljs-keyword">node</span><span class="hljs-title">-v6</span>.<span class="hljs-number">10.3</span>.tar.gz<br>cd  <span class="hljs-keyword">node</span><span class="hljs-title">-v6</span>.<span class="hljs-number">10.3</span><br>./configure<br>make<br>make install<br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="安装-cnpm-镜像（可选择）"><a href="#安装-cnpm-镜像（可选择）" class="headerlink" title="安装 cnpm 镜像（可选择）"></a>安装 cnpm 镜像（可选择）</h3><p><a target="_blank" rel="noopener" href="https://npm.taobao.org/">淘宝 NPM 镜像</a>是一个完整 npmjs.org 镜像，你可以用此代替官方版本(只读)，同步频率目前为 10 分钟 一次以保证尽量与官方服务同步。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">npm install -g cnpm <span class="hljs-attr">--registry</span>=https:<span class="hljs-comment">//registry.npm.taobao.org</span><br>cnpm install <span class="hljs-selector-attr">[name]</span><br></code></pre></td></tr></table></figure>

<h3 id="使用-vue-cli"><a href="#使用-vue-cli" class="headerlink" title="使用 vue-cli"></a>使用 vue-cli</h3><ol>
<li><p>安装</p>
<p> 如果用 npm 下载速度慢，可以使用 cnpm.</p>
 <figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">npm install -g vue-<span class="hljs-keyword">cli</span><br></code></pre></td></tr></table></figure></li>
<li><p>init 初始模板</p>
<p> 目前可用的模板包括：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/vuejs-templates/browserify">browserify</a>–全功能的 Browserify + vueify，包括热加载，静态检测，单元测试</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/vuejs-templates/browserify-simple">browserify-simple</a>–一个简易的 Browserify + vueify，以便于快速开始。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/vuejs-templates/webpack">webpack</a>–全功能的 Webpack + vueify，包括热加载，静态检测，单元测试</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/vuejs-templates/webpack-simple">webpack-simple</a>–一个简易的 Webpack + vueify，以便于快速开始。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/vuejs-templates/simple">simple</a> - 单个 HTML 文件中最简单的 Vue 设置</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">vue init &lt;<span class="hljs-keyword">template</span>-<span class="hljs-type">name</span>&gt; &lt;project-<span class="hljs-type">name</span>&gt;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>运行项目</p>
<ol>
<li>我们的项目选择 webpack,使用以下命令:</li>
</ol>
 <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">vue <span class="hljs-keyword">init</span> webpack vue-todos<br></code></pre></td></tr></table></figure>

<ol start="2">
<li><p>输入下面的命令就可以运行这个项目了:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">cd vue-todos<br><span class="hljs-built_in">npm</span> install<br><span class="hljs-built_in">npm</span> run dev<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h2 id="CentOS7-安装-Nginx"><a href="#CentOS7-安装-Nginx" class="headerlink" title="CentOS7 安装 Nginx"></a>CentOS7 安装 Nginx</h2><h2 id="安装所需环境"><a href="#安装所需环境" class="headerlink" title="安装所需环境"></a>安装所需环境</h2><p>Nginx 是 C 语言 开发，建议在 Linux 上运行，当然，也可以安装 Windows 版本，本篇则使用 <a target="_blank" rel="noopener" href="http://www.linuxidc.com/topicnews.aspx?tid=14">CentOS</a> 7 作为安装环境。</p>
<p>顺序如下：</p>
<ol>
<li><p><strong>gcc 安装</strong></p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">yum install gcc</span><span class="hljs-literal">-</span><span class="hljs-comment">c</span><span class="hljs-literal">++</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>PCRE pcre-devel 安装</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y pcre pcre-devel<br></code></pre></td></tr></table></figure></li>
<li><p><strong>zlib 安装</strong></p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">yum install -y <span class="hljs-literal">zlib</span> <span class="hljs-literal">zlib</span>-devel<br></code></pre></td></tr></table></figure></li>
<li><p><strong>OpenSSL 安装</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y openssl openssl-devel<br></code></pre></td></tr></table></figure></li>
<li><p>下载<code>.tar.gz</code>安装包</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget -c https:<span class="hljs-regexp">//</span>nginx.org<span class="hljs-regexp">/download/</span>nginx-<span class="hljs-number">1.12</span>.<span class="hljs-number">0</span>.tar.gz<br></code></pre></td></tr></table></figure></li>
<li><p>解压</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf nginx-<span class="hljs-number">1</span>.<span class="hljs-number">12</span>.<span class="hljs-number">0</span>.tar.gz<br><span class="hljs-attribute">cd</span> nginx-<span class="hljs-number">1</span>.<span class="hljs-number">12</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>配置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./configure<br></code></pre></td></tr></table></figure></li>
<li><p>编译安装</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-built_in">make</span><br><span class="hljs-built_in">make</span> install<br></code></pre></td></tr></table></figure></li>
<li><p>启动、停止 nginx</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> <span class="hljs-string">/usr/local/nginx/sbin/</span><br><span class="hljs-string">./nginx</span><br><span class="hljs-string">./nginx</span> -s stop<br><span class="hljs-string">./nginx</span> -s <span class="hljs-keyword">quit</span><br><span class="hljs-string">./nginx</span> -s <span class="hljs-keyword">reload</span><br></code></pre></td></tr></table></figure></li>
<li><p>重启 <strong>nginx</strong></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin/<br>./nginx -s reload<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="CSS-Tools-Reset-CSS-重置-css"><a href="#CSS-Tools-Reset-CSS-重置-css" class="headerlink" title="CSS Tools: Reset CSS 重置 css"></a>CSS Tools: Reset CSS 重置 css</h2><p>浏览器自带的 css 属性，一般需要重置，记录如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html">/* http://meyerweb.com/eric/tools/css/reset/ v2.0 | 20110126 License: none<br>(public domain) */ html, body, div, span, applet, object, iframe, h1, h2, h3,<br>h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del,<br>dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b,<br>u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table,<br>caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details,<br>embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby,<br>section, summary, time, mark, audio, video &#123; margin: 0; padding: 0; border: 0;<br>font-size: 100%; font: inherit; vertical-align: baseline; &#125; /* HTML5<br>display-role reset for older browsers */ article, aside, details, figcaption,<br>figure, footer, header, hgroup, menu, nav, section &#123; display: block; &#125; body &#123;<br>line-height: 1; &#125; ol, ul &#123; list-style: none; &#125; blockquote, q &#123; quotes: none; &#125;<br>blockquote:before, blockquote:after, q:before, q:after &#123; content: &#x27;&#x27;; content:<br>none; &#125; table &#123; border-collapse: collapse; border-spacing: 0; &#125;<br></code></pre></td></tr></table></figure>


<h3 id="记录："><a href="#记录：" class="headerlink" title="记录："></a>记录：</h3><ul>
<li><p>Vetur</p>
<p>使用 scss 的时候，会遇到 vetur 报错的情况：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span><br>    @keyframes glitch-one &#123;<br>  @for $i from 20 to 30 &#123;<br>    #&#123;$i / 2&#125;% &#123;<br>      left: #&#123;randomNum(200, -100)&#125;px;<br>      clip-path: inset(#&#123;randomNum(150, 30)&#125;px 0 #&#123;randomNum(150, 30)&#125;px);<br>    &#125;<br>  &#125;<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>比如上面的这种情况，就会有红色波浪线提示，但是在浏览器中是正确的。所以需要配置如下：</p>
<ol>
<li><p>文件》首选项》设置</p>
</li>
<li><p>右上角三个选项的第一个（打开设置 Json）</p>
</li>
<li><p>在大括号内添加最后四行（跟 vetur 相关的配置）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123; &quot;workbench.iconTheme&quot;: &quot;vscode-icons&quot;, &quot;[html]&quot;: &#123;<br>&quot;editor.defaultFormatter&quot;: &quot;vscode.html-language-features&quot; &#125;,<br>&quot;open-in-browser.default&quot;: &quot;chrome&quot;, &quot;explorer.confirmDragAndDrop&quot;: false,<br>&quot;window.zoomLevel&quot;: 1, &quot;[javascript]&quot;: &#123; &quot;editor.defaultFormatter&quot;:<br>&quot;vscode.typescript-language-features&quot; &#125;, &quot;explorer.confirmDelete&quot;: false,<br>&quot;vsicons.dontShowNewVersionMessage&quot;: true, &quot;editor.fontSize&quot;: 20, &quot;[css]&quot;:<br>&#123; &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot; &#125;,<br>&quot;vetur.validation.template&quot;: false,<br>&quot;vetur.experimental.templateInterpolationService&quot;: false,<br>&quot;vetur.validation.style&quot;: false, &quot;vetur.validation.script&quot;: false, &#125;<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h2 id="GitHub-相关问题"><a href="#GitHub-相关问题" class="headerlink" title="GitHub 相关问题"></a>GitHub 相关问题</h2><p>GitHub 是一个面向<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BC%80%E6%BA%90/20720669">开源</a>及私有<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6/12053">软件</a>项目的托管平台，因为只支持 git 作为唯一的版本库格式进行托管，故名 GitHub。</p>
<h2 id="初始设置-github"><a href="#初始设置-github" class="headerlink" title="初始设置 github"></a>初始设置 github</h2><p>记录开始使用 GitHub 中三点注意：</p>
<ol>
<li><p>注册账号会验证邮箱，而 163 邮箱不能接受验证邮件</p>
<p>**<em>注意</em>**：注册需要设置邮箱，需要选用 qq 邮箱或者 gmail 邮箱，163 邮箱发现不能接收到 GitHub 的邮件！</p>
<p>新的库，需要设置 sshkeys</p>
<ol>
<li><p>检查是否有 sshkeys</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">~/.ssh<br></code></pre></td></tr></table></figure></li>
<li><p>创建 ssh</p>
<p>首先创建一个 SSH，在 Git Bash 中输入</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>ssh-keygen -t rsa -C “你的邮箱”<br></code></pre></td></tr></table></figure>

<p>然后他就会显示这两行</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">Generating <span class="hljs-keyword">public</span>/<span class="hljs-keyword">private</span> rsa key pair.<br>Enter <span class="hljs-keyword">file</span> in which to save the key (<span class="hljs-regexp">/c/U</span>sers<span class="hljs-regexp">/16627/</span>.ssh/id_rsa):<br></code></pre></td></tr></table></figure>

<p>这是让你输入一个文件名，用于保存刚才生成的 SSH key 代码。如果你不输入，直接回车，那么就会默认生成 id_rsa 和 id_rsa.pub 两个秘钥文件（如下提示）。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">Created directory ‘<span class="hljs-regexp">/c/</span>Users<span class="hljs-regexp">/16627/</span>.ssh’.<br></code></pre></td></tr></table></figure>

<p>紧接着又会提示你</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">Enter</span> <span class="hljs-variable">passphrase</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">empty</span> <span class="hljs-variable">for</span> <span class="hljs-variable">no</span> <span class="hljs-variable">passphrase</span><span class="hljs-punctuation">)</span><span class="hljs-operator">:</span><br><span class="hljs-built_in">Enter</span> <span class="hljs-variable">same</span> <span class="hljs-variable">passphrase</span> <span class="hljs-variable">again</span><span class="hljs-operator">:</span><br></code></pre></td></tr></table></figure>

<p>接着又会提示你输入两次密码（该密码是你 push 文件的时候要输入的密码，而不是 github 管理者的密码），当然你还可以不输入密码，直接按回车。那么 fetch 和 push 的时候就不需要输入密码。</p>
<p><img src="https://img-blog.csdn.net/20180118114145818?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="/img/loading.gif" lazyload alt="chegngong"></p>
<p>已经创建成功</p>
<p><img src="https://img-blog.csdn.net/20180118115923234?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="/img/loading.gif" lazyload alt="chenggong"></p>
</li>
<li><p>添加 ssh 到 GitHub</p>
<p>按照以下的步骤操作：</p>
<p><img src="https://img-blog.csdn.net/20180118120316317?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="/img/loading.gif" lazyload alt="1"></p>
<p><img src="https://img-blog.csdn.net/20180118120349241?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="/img/loading.gif" lazyload alt="2"></p>
<p><img src="https://img-blog.csdn.net/20180118120556118?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="/img/loading.gif" lazyload alt="3"></p>
<p>title 随便给他起个名字就好。然后是 key，这时候你要打开你刚才在电脑上的 SSH key。刚才提示你建立的那段文字有 SSH key 的地址，按照地址找到你的文件，用记事本<strong>打开 id_rsa.pub 文件，全选其中的内容粘贴到网页的 Key 中即可。</strong></p>
<p><img src="https://img-blog.csdn.net/20180118121323658?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="/img/loading.gif" lazyload alt="4"></p>
<p><img src="https://img-blog.csdn.net/20180118121457269?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="/img/loading.gif" lazyload alt="5"></p>
<p><strong>然后你就会受到建立成功的邮件了。</strong></p>
<p><img src="https://img-blog.csdn.net/20180118121751176?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzY2NjcxNzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="/img/loading.gif" lazyload alt="6"></p>
</li>
<li><p>测试一下 ssh key</p>
<p>在 git Bash 中输入以下代码：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ssh</span> -T git<span class="hljs-variable">@github</span>.com<br>注意是git<span class="hljs-variable">@github</span>.com，不是你的邮箱。<br></code></pre></td></tr></table></figure>

<p>然后会提示你：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">The authenticity of host ‘github.<span class="hljs-keyword">com</span> (<span class="hljs-number">192.30</span>.<span class="hljs-number">255.112</span>)’ can’t <span class="hljs-keyword">be</span> established.<br>RSA key fingerprint <span class="hljs-keyword">is</span> SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.<br>Are you sure you want <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span> connecting (yes/<span class="hljs-keyword">no</span>)?<br></code></pre></td></tr></table></figure>

<p>正常提示，你只需要 YES 就可以。如果你创建 SSH key 的时候设置了密码，接下来就会提示你输入密码，如果你没设置密码会提示你:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">Warning: Permanently added ‘github.<span class="hljs-keyword">com</span>,<span class="hljs-number">192.30</span>.<span class="hljs-number">255.112</span>’ (RSA) <span class="hljs-keyword">to</span> the <span class="hljs-keyword">list</span> of known hosts.<br>Hi “用户名”! You’<span class="hljs-keyword">ve</span> successfully authenticated, but GitHub does not provide <span class="hljs-keyword">shell</span> access.<br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>需要设置 config.name 和 config.email</p>
<ul>
<li><p>按照以下的步骤操作</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.name</span> <span class="hljs-string">&quot;yourname&quot;</span> 设置用户名<br>git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.email</span> myemail@qq<span class="hljs-selector-class">.com</span> 设置用户邮箱<br>git config <span class="hljs-attr">--list</span> 查看git设置列表信息<br>git config user<span class="hljs-selector-class">.name</span>  查看用户名<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h2 id="git-推动-GitHub-提示-faild"><a href="#git-推动-GitHub-提示-faild" class="headerlink" title="git 推动 GitHub 提示 faild"></a>git 推动 GitHub 提示 faild</h2><p>在添加远程库的时候一直验证不成功，一直提示 failed to push some refs to git 的问题，经过网上查找终于解决了这个问题。</p>
<p>主要问题指向了 README.md 文件</p>
<h3 id="git-步骤如下"><a href="#git-步骤如下" class="headerlink" title="git 步骤如下"></a>git 步骤如下</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html">1. git add . //添加到暂存区 2. git commit -m &quot;备注内容&quot; //添加到head 3. git push<br>-u origin master //添加到远程仓库<br></code></pre></td></tr></table></figure>

<p>其中第三步出错，提示 ailed to push some refs to git</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>出现错误的主要原因是 github 中的 README.md 文件不在本地代码目录中，</p>
<p>可以通过如下命令进行代码合并【注：pull=fetch+merge]</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">git pull --rebase origin master<br></code></pre></td></tr></table></figure>

<p>执行上面代码后可以看到本地代码库中多了 README.md 文件</p>
<p>此时再执行语句 git push -u origin master 即可完成代码上传到 github</p>
<meta name="referrer" content="no-referrer"/>

<h2 id="keep-alive-的使用与周期"><a href="#keep-alive-的使用与周期" class="headerlink" title="keep-alive 的使用与周期"></a>keep-alive 的使用与周期</h2><h3 id="使用-keep-alive-的时机"><a href="#使用-keep-alive-的时机" class="headerlink" title="使用 keep-alive 的时机"></a>使用 keep-alive 的时机</h3><p>在搭建 vue 项目时，有某些组件没必要多次渲染，所以需要将组件在内存中进行‘持久化，此时 keep-alive 便可以派上用场了。keep-alive 可以使被包含的组件状态维持不变，即便是组件切换了，其内的状态依旧维持在内存之中。在下一次显示时，也不会重现渲染。</p>
<blockquote>
<p>PS：<code>与</code>相似，只是一个抽象组件，它不会在 DOM 树中渲染(真实或者虚拟都不会)，也不在父组件链中存在，比如：你永远在 <code>this.$parent</code> 中找不到 <code>keep-alive</code> 。</p>
</blockquote>
<!-- more -->

<h3 id="配合-router-view-去使用"><a href="#配合-router-view-去使用" class="headerlink" title="配合 router-view 去使用"></a>配合 router-view 去使用</h3><p>有些时候可能需要将整个路由页面一切缓存下来，也就是将 `` 进行缓存。这种使用场景还是蛮多的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;keep-alive&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;$router.meta.keepAlive&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span></span><br>&lt;/keep-alive&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;!$router.meta.keepAlive&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span></span><br><br><span class="hljs-comment">//router配置</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>(&#123;<br>    <span class="hljs-attr">routes</span>: [<br>        &#123;<br>            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;a&#x27;</span>,<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/a&#x27;</span>,<br>            <span class="hljs-attr">component</span>: A,<br>            <span class="hljs-attr">meta</span>: &#123;<br>                <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span><br>            &#125;<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;b&#x27;</span>,<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/b&#x27;</span>,<br>            <span class="hljs-attr">component</span>: B<br>        &#125;<br>    ]<br>&#125;)<br></code></pre></td></tr></table></figure>

<h3 id="keep-alive-生命周期和新属性"><a href="#keep-alive-生命周期和新属性" class="headerlink" title="keep-alive 生命周期和新属性"></a>keep-alive 生命周期和新属性</h3><h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p>被包含在 ``中创建的组件，会多出两个生命周期的钩子:<code>activated</code>与<code>deactivated</code></p>
<ul>
<li>activated</li>
</ul>
<p>在组件被激活时调用，<strong>在组件第一次渲染时也会被调用</strong>，之后每次 keep-alive 激活时被调用。</p>
<ul>
<li>deactivated</li>
</ul>
<p>在组件被停用时调用。</p>
<blockquote>
<p>注意：只有组件被 <code>keep-alive</code> 包裹时，这两个生命周期才会被调用，如果作为正常组件使用，是不会被调用，以及在 <code>2.1.0</code> 版本之后，使用 <code>exclude</code> 排除之后，就算被包裹在 <code>keep-alive</code> 中，这两个钩子依然不会被调用！另外在服务端渲染时此钩子也不会被调用的。</p>
</blockquote>
<h4 id="新属性"><a href="#新属性" class="headerlink" title="新属性"></a>新属性</h4><p>在 vue <code>2.1.0</code> 版本之后，<code>keep-alive</code> 新加入了两个属性: <code>include</code>(包含的组件缓存生效) 与 <code>exclude</code>(排除的组件不缓存，优先级大于 include) 。</p>
<p><code>include</code> 和 <code>exclude</code> 属性允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示</p>
<p>当使用正则或者是数组时，一定要使用 <code>v-bind</code> !</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!-- 逗号分隔字符串，只有组件a与b被缓存。这样使用场景变得更有意义了 --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">include</span>=<span class="hljs-string">&quot;a,b&quot;</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">&quot;view&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span></span><br><br>&lt;!-- 正则表达式 (需要使用 v-bind，符合匹配规则的都会被缓存) --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">&quot;/a|b/&quot;</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">&quot;view&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span></span><br><br>&lt;!-- <span class="hljs-title class_">Array</span> (需要使用 v-bind，被包含的都会被缓存) --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">:include</span>=<span class="hljs-string">&quot;[&#x27;a&#x27;, &#x27;b&#x27;]&quot;</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">&quot;view&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li>有了 include 之后，再与 <code>router-view</code> 一起使用时便方便许多了:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!-- 一个include解决了，不需要多写一个标签，也不需要在路由元中添加keepAlive了 --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span> <span class="hljs-attr">include</span>=<span class="hljs-string">&#x27;a&#x27;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">keeo-alive</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol>
<li><p>keeo-alive 先匹配被包含组件的 <code>name</code> 字段，如果 <code>name</code> 不可用，则匹配当前组件 <code>components</code> 配置中的注册名称。</p>
</li>
<li><p>keeo-alive 不会在函数式组件中正常工作，因为它们没有缓存实例。</p>
</li>
<li><p>当匹配条件同时在 <code>include</code> 与 <code>exclude</code> 存在时，以 <code>exclude</code> 优先级最高(当前 vue 2.4.2 version)。比如：包含于排除同时匹配到了组件 A，那组件 A 不会被缓存。</p>
</li>
<li><p>包含在 keeo-alive 中，但符合 <code>exclude</code> ，不会调用<code>activated</code> 和 <code>deactivated</code>。</p>
</li>
<li><p><strong>设置了<code>keep-alive</code>,这个时候不会触发生命周期的钩子函数。</strong></p>
<p>当页面内的数据没有发生变化时，页面内的操作比如跳转到另一个路由，是不会去经过生命周期函数的，比如：desdtroy 函数等。</p>
<p>它会直接在进入的时候触发<code>activated</code> 和离开的时候触发 deactivated。</p>
<p>所以，如果是有涉及到之前放入 mouted 周期中的函数，可以将其放入 activated，放入 desdtroy 周期的函数可以放入 deactivated。</p>
</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/vue/">#vue</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Vue使用</div>
      <div>http://lenmon54231.github.io/2022/09/15/Vue使用/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Meng_Lee</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年9月15日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/03/21/%E5%9F%8B%E7%82%B9%E7%9A%84%E9%85%8D%E7%BD%AE/" title="埋点的配置">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">埋点的配置</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/09/15/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%AE%B0%E5%BD%95/" title="移动端记录">
                        <span class="hidden-mobile">移动端记录</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
